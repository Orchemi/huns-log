---
title: "[Django] HTTP Handling, Imageì™€ Media"

categories:
  - Django

tags:
  - Django

date: 2022-04-08T12:30
last_modified_at: 2022-04-08T12:30
author_profile: true

toc: true
toc_label: "ëª©ì°¨"
toc_icon: "bars"
toc_sticky: true
published: true
---

## Handling HTTP requests

> Djangoì—ì„œ HTTP ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•

1. Django shortcut functions
2. View decorators

<br />

### Django shortcut functions

- django.shortcuts íŒ¨í‚¤ì§€ëŠ” ê°œë°œì— ë„ì›€ì´ ë˜ëŠ” ì—¬ëŸ¬ í•¨ìˆ˜ / í´ë˜ìŠ¤ ì œê³µ
- **render()**, **redirect()**, get_object_or_404(), get_list_or404()

<br />

> render() 

templateì„ í™”ë©´ì— renderí•˜ëŠ” í•¨ìˆ˜

<br />

> redirect()

ë‹¤ì‹œ viewsì˜ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜

<br />

#### get_object_or_404()

- model managerì¸ objectsì—ì„œ get()ì„ í˜¸ì¶œ
- í•´ë‹¹ ê°ì²´ê°€ ì—†ì„ ê²½ìš° **DoesNotExist** ì˜ˆì™¸ ëŒ€ì‹  **Http 404ë¥¼ raise**

- get()ì— ê²½ìš° ì¡°ê±´ì— ë§ëŠ” ë°ì´í„°ê°€ ì—†ì„ ê²½ìš° ì˜ˆì™¸ ë°œìƒ
- **ì½”ë“œ ì‹¤í–‰ ë‹¨ê³„ì—ì„œ ë°œìƒí•œ ì˜ˆì™¸ ë° ì—ëŸ¬**ì— ëŒ€í•´ì„œ ë¸Œë¼ìš°ì €ëŠ” **http status code 500ìœ¼ë¡œ ì¸ì‹**
- http ì½”ë“œ ìƒíƒœ
    - 400ë²ˆëŒ€ : clientì˜ ì˜ëª»(ì˜ëª»ëœ ì •ë³´ ìš”ì²­)
    - 500ë²ˆëŒ€ : serverì˜ ì˜ëª»(ì„œë²„ê°€ ì²˜ë¦¬ ë°©ë²•ì„ ëª¨ë¥´ëŠ” ìƒí™©)
    - ìƒíƒœ ë²ˆí˜¸ì— ë”°ë¼ ìœ ì €ê°€ ì˜ëª»ëœ ì •ë³´ë¥¼ ìš”ì²­í–ˆëŠ”ì§€, ì„œë²„ ìª½ì˜ ì—ëŸ¬ì¸ì§€ ì•Œë ¤ì¤Œ
- **ìƒí™©ì— ë”°ë¼ ì ì ˆí•œ ì˜ˆì™¸ì²˜ë¦¬** ë° í´ë¼ì´ì–¸íŠ¸ì—ê²Œ **ì˜¬ë°”ë¥¸ ì—ëŸ¬ ìƒí™©ì„ ì „ë‹¬**í•˜ëŠ” ê²ƒ ë˜í•œ ê°œë°œì˜ ì¤‘ìš”í•œ ìš”ì†Œ ì¤‘ í•˜ë‚˜

<br />

```python
# views.py

def detail(request, pk):
    # article = Article.objects.get(pk=pk)
    article = get_object_or_404(Article, pk=pk)
    context = {
        'article': article,
    }
    return render(request, 'articles/detail.html', context)
```

- ê¸°ì¡´ì—ëŠ” DBì—ì„œ get() í•¨ìˆ˜ë¡œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ articleì— ì €ì¥
- get_object_or_404() í•¨ìˆ˜ë¥¼ ì´ìš©í•´ **pkê°€ pkì¸ Articleì˜ ì¸ìŠ¤í„´ìŠ¤**ë¥¼ ê°€ì ¸ì™€ articleì— ì €ì¥
- ë§Œì•½ ì—†ë‹¤ë©´ **404 Not Found ì—ëŸ¬ ë°œìƒ**ì‹œí‚¨ë‹¤.

<br />

#### get_list_or_404()

- ê²Œì‹œíŒì—ì„œ ì‚¬ìš©ì€ ë¶€ì í•©(ì²« ë²ˆì§¸ ê¸€ì´ ì—†ìœ¼ë©´ main pageê°€ ë Œë”ë§ë˜ì§€ ì•Šì•„ì„œ)
- APIë¥¼ ë°›ì•„ì˜¬ ë•Œ ì‚¬ìš©

<br />

### View decorators

- DjangoëŠ” ë‹¤ì–‘í•œ HTTP ê¸°ëŠ¥ì„ ì§€ì›í•˜ê¸° ìœ„í•´ **view í•¨ìˆ˜**ì— ì ìš©í•  ìˆ˜ ìˆëŠ” ì—¬ëŸ¬ **decorator**ë¥¼ ì œê³µ

> Decorator

- ì–´ë–¤ í•¨ìˆ˜ì— ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ê³  ì‹¶ì„ ë•Œ, í•´ë‹¹ **í•¨ìˆ˜ë¥¼ ìˆ˜ì •í•˜ì§€ ì•Šê³  ê¸°ëŠ¥ì„ ì—°ì¥í•´ì£¼ëŠ” í•¨ìˆ˜**
- ì›ë³¸ í•¨ìˆ˜ë¥¼ **ìˆ˜ì •í•˜ì§€ ì•Šìœ¼ë©´ì„œ ì¶”ê°€ ê¸°ëŠ¥ë§Œì„ êµ¬í˜„**í•  ë•Œ ì‚¬ìš©

<br />

#### Allowed HTTP methods

- **ìš”ì²­ method**ì— ë”°ë¼ view í•¨ìˆ˜ì— ëŒ€í•œ **ì—‘ì„¸ìŠ¤ë¥¼ ì œí•œ**
- ìš”ì²­ì´ ì¡°ê±´ì„ ì¶©ì¡±ì‹œí‚¤ì§€ ëª»í•˜ë©´ **HttpResponseNotAllowedì„ return**
- **405 Method Not Allowed**

- require_http_methods(), require_POST(), require_safe()

<br />

> require_http_methods()

- view í•¨ìˆ˜ê°€ **íŠ¹ì •í•œ method ìš”ì²­ì— ëŒ€í•´ì„œë§Œ í—ˆìš©**í•˜ë„ë¡ í•˜ëŠ” decorator
- list í˜•ì‹ìœ¼ë¡œ http method ëª©ë¡ì„ ì œí•œ

```python
from django.views.decorators.http import require_http_method

@require_http_methods(["GET", "POST"])
def my_view(request):
    ...
```

<br />

> require_POST()

- view í•¨ìˆ˜ê°€ **POST method ìš”ì²­ë§Œ ìŠ¹ì¸**í•˜ë„ë¡ í•˜ëŠ” decorator
- POST methodë§Œ ì‚¬ìš©í•˜ëŠ” delete() view í•¨ìˆ˜ë¥¼ ì‚´í´ë³´ì.

```python
# ê¸°ì¡´
def delete(request, pk):
    # article = Article.objects.get(pk=pk)
    article = get_object_or_404(Article, pk=pk)
    if request.method == 'POST':
        article.delete()
        return redirect('articles:index')
    return redirect('articles:detail', article.pk)


# require_POST ì‚¬ìš©
@require_POST
def delete(request, pk):
    # article = Article.objects.get(pk=pk)
    article = get_object_or_404(Article, pk=pk)
    article.delete()
    return redirect('articles:index')
```

- request.methodê°€ POSTì¼ ë•Œì™€ ì•„ë‹ ë•Œì˜ returnì„ ë‹¬ë¦¬ í•  í•„ìš”ê°€ ì—†ë‹¤.
- request.methodë¥¼ í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ POSTì¸ì§€ í™•ì¸í•  í•„ìš”ê°€ ì—†ë‹¤.
- ì´ë¥¼ ì •ë¦¬í•´ì¤„ ìˆ˜ ìˆë‹¤.

<br />

> require_safe()

- view í•¨ìˆ˜ê°€ **GET(ë° HEAD method)ë§Œ í—ˆìš©í•˜ë„ë¡ ìš”êµ¬**í•˜ëŠ” decorator
- djangoëŠ” **require_GET() ëŒ€ì‹  require_safe()**ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥

<br />

## Media files

- **ì‚¬ìš©ìê°€ ì›¹ì—ì„œ ì—…ë¡œë“œí•˜ëŠ” ì •ì  íŒŒì¼**

<br />

### Model field : ImageField()

- ì´ë¯¸ì§€ ì—…ë¡œë“œì— ì‚¬ìš©í•˜ëŠ” ëª¨ë¸ í•„ë“œ
- **FileFieldë¥¼ ìƒì†ë°›ëŠ” ì„œë¸Œ í´ë˜ìŠ¤** â†’ FileFieldì˜ ëª¨ë“  ì†ì„± ë° ë©”ì„œë“œ ì‚¬ìš© ê°€ëŠ¥
- ì¶”ê°€ë¡œ ì‚¬ìš©ìì— ì˜í•´ ì—…ë¡œë“œëœ ê°ì²´ê°€ ìœ íš¨í•œ ì´ë¯¸ì§€ì¸ì§€ ê²€ì‚¬

- ImageField ì¸ìŠ¤í„´ìŠ¤ëŠ” ìµœëŒ€ ê¸¸ì´ê°€ 100ìì¸ ë¬¸ìì—´ë¡œ DBì— ìƒì„±
- max_length ì¸ìë¥¼ ì‚¬ìš©í•˜ì—¬ ìµœëŒ€ ê¸¸ì´ë¥¼ ë³€ê²½

- ì£¼ì˜ğŸ“¢ : ì‚¬ìš©í•˜ë ¤ë©´ ë°˜ë“œì‹œ **Pillow ë¼ì´ë¸ŒëŸ¬ë¦¬** í•„ìš”
- ImageField migration ì‹œ í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬

<br />

### FileField()

- íŒŒì¼ ì—…ë¡œë“œì— ì‚¬ìš©í•˜ëŠ” ëª¨ë¸ í•„ë“œ
- 2ê°œì˜ ì„ íƒ ì¸ì : **upload_to**, storage
- ì°¸ê³ ìë£Œ : `[django ê³µì‹ë¬¸ì„œ - Model Field Types](https://docs.djangoproject.com/en/4.0/ref/models/fields/#field-types)`

<br />

### ImageField ì‘ì„±ë²•

- upload_to='images/'
- ì‹¤ì œ ì´ë¯¸ì§€ê°€ ì €ì¥ë˜ëŠ” ê²½ë¡œ ì§€ì •

- blank=True
- ê¸°ë³¸ê°’ì€ False
- ì´ë¯¸ì§€ í•„ë“œì— ë¹ˆ ê°’(ë¹ˆ ë¬¸ìì—´)ì´ í—ˆìš©ë˜ë„ë¡ ì„¤ì •(**ì´ë¯¸ì§€ë¥¼ ì„ íƒì ìœ¼ë¡œ ì—…ë¡œë“œ** ê°€ëŠ¥)

<br />

#### ì½”ë“œ

```python
# models.py

class Article(models.Model):
    title = models.CharField(max_length=10)
    content = models.TextField()
    # saved to 'MEDIA_ROOT/images/'
    image = models.ImageField(upload_to='images/', blank=True) â­
    created_at = models.DateTimeField(auto_now_add=True)
    ...
```

<br />

#### upload_to argument

- ì—…ë¡œë“œ ë””ë ‰í† ë¦¬ì™€ íŒŒì¼ ì´ë¦„ì„ ì„¤ì •í•˜ëŠ” 2ê°€ì§€ ë°©ë²• ì œê³µ

> ê°€. ë¬¸ìì—´ ê°’ì´ë‚˜ ê²½ë¡œ ì§€ì •

- íŒŒì´ì¬ì˜ strftime() í˜•ì‹ì´ í¬í•¨ ê°€ëŠ¥
- íŒŒì¼ ì—…ë¡œë“œ ë‚ ì§œ/ì‹œê°„ìœ¼ë¡œ ëŒ€ì²´

```python
# models.py

class MyModel(models.Model):
    # MEDIA_ROOT/uploads/ ê²½ë¡œë¡œ íŒŒì¼ ì—…ë¡œë“œ
    upload = models.FileField(upload_to='uploads/')

    # MEDIA_ROOT/uploads/2021/01/01/ ê²½ë¡œë¡œ íŒŒì¼ ì—…ë¡œë“œ
    upload = models.FileField(upload_to='uploads/%Y/%m/%d/')
```

<br />

> ì°¸ê³  : time ëª¨ë“ˆì˜ strftime()

- time.strftime(format[, t])
- ë‚ ì§œ ë° ì‹œê°„ ê°ì²´ë¥¼ ë¬¸ìì—´ í‘œí˜„ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ë° ì‚¬ìš©

<br />

> ë‚˜. í•¨ìˆ˜ í˜¸ì¶œ

- ì²´ê³„ì ìœ¼ë¡œ ê²½ë¡œë¥¼ ì§€ì •

```python
# models.py

def articles_image_path(instance, filename):
    # 'MEDIA_ROOT/image_<pk>/' ê²½ë¡œì— '<filename>' ì´ë¦„ìœ¼ë¡œ ì—…ë¡œë“œ
    return f'image_{instance.pk}/{filename}'

class Article(models.Model):
    image = models.ImageField(upload_to=articles_image_path)
```

<br />

#### Model field option : blank

- ê¸°ë³¸ê°’: False

- Trueì¸ ê²½ìš° í•„ë“œë¥¼ ë¹„ì›Œë‘˜ ìˆ˜ ìˆë‹¤.
- DBì—ëŠ” ''(ë¹ˆ ë¬¸ìì—´)ì´ ì €ì¥

- ìœ íš¨ì„± ê²€ì‚¬ì—ì„œ ì‚¬ìš©(is_valid)
- ëª¨ë¸ í•„ë“œì— blank=Trueë¥¼ ì‘ì„±í•˜ë©´ form ìœ íš¨ì„± ê²€ì‚¬ì—ì„œ ë¹ˆ ê°’ì„ ì…ë ¥ ê°€ëŠ¥

<br />

#### Model field option : "null"

- ê¸°ë³¸ê°’: False
- Trueì¸ ê²½ìš° djangoëŠ” **ë¹ˆ ê°’ì— ëŒ€í•´ DBì— NULLë¡œ ì €ì¥**

<br />

> ì£¼ì˜ ì‚¬í•­

- CharField, TextFieldì™€ ê°™ì€ **ë¬¸ìì—´ ê¸°ë°˜ í•„ë“œì—ëŠ” ì‚¬ìš©í•˜ëŠ” ê²ƒì„ í”¼í•´ì•¼ í•œë‹¤.**
- ë¬¸ìì—´ ê¸°ë°˜ í•„ë“œì— Trueë¡œ ì„¤ì • ì‹œ **'ë°ì´í„° ì—†ìŒ(no data)'**ì— "ë¹ˆ ë¬¸ìì—´(1)"ê³¼ "NULL(2)"ì˜ 2ê°€ì§€ ê°€ëŠ¥í•œ ê°’ì´ ìˆìŒì„ ì˜ë¯¸
- ëŒ€ë¶€ë¶„ì˜ ê²½ìš° "ë°ì´í„° ì—†ìŒ"ì— ëŒ€í•´ í•œ ê°€ì§€ì˜ ê°€ëŠ¥í•œ ê°’ì„ ê°€ì§„ë‹¤.
- DjangoëŠ” **NULLì´ ì•„ë‹Œ ë¹ˆ ë¬¸ìì—´ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê·œì¹™**ìœ¼ë¡œ í•œë‹¤.

<br />

> blank & null ë¹„êµ

```python
# models.py

class Person(models.Model):
    name = models.CharField(max_length=10)

    # null=True ê¸ˆì§€
    bio = models.TextField(max_length=50, blank=True)

    # ë¬¸ìì—´ í•„ë“œ ì•„ë‹Œ ê²½ìš° : null, blank ëª¨ë‘ ì„¤ì • ê°€ëŠ¥
    birth_date = models.DateField(null=True, blank=True)
```

- blank : Validation-related
- null : Database-related

- ë¬¸ìì—´ ê¸°ë°˜ ë° ë¹„ë¬¸ìì—´ ê¸°ë°˜ í•„ë“œ ëª¨ë‘ì— ëŒ€í•´ null optionì€ DBì—ë§Œ ì˜í–¥
- formì—ì„œ ë¹ˆ ê°’ì„ í—ˆìš©í•˜ë ¤ë©´ blank=Trueë¥¼ ì„¤ì •

<br />

### ImageField(or FileField) ì‚¬ìš©ì„ ìœ„í•œ ë‹¨ê³„

1. settings.pyì— **MEDIA_ROOT**, **MEDIA_URL** ì„¤ì •
2. **upload_to ì†ì„±ì„ ì •ì˜**í•˜ì—¬ ì—…ë¡œë“œëœ íŒŒì¼ì— ì‚¬ìš©í•  ****MEDIA_ROOTì˜ í•˜ìœ„ ê²½ë¡œë¥¼ ì§€ì •**
3. ì—…ë¡œë“œëœ íŒŒì¼ì˜ ê²½ë¡œëŠ” **djangoê°€ ì œê³µí•˜ëŠ” 'url' ì†ì„±**ì„ í†µí•´ ì–»ì„ ìˆ˜ ìˆë‹¤.

```html
{%- raw -%}
<img src="{{ article.image.url }}" alt="{{ article.image }}">
{% endraw -%}
```

<br />

#### MEDIA_ROOT

- ì‚¬ìš©ìê°€ ì—…ë¡œë“œí•œ íŒŒì¼(ë¯¸ë””ì–´ íŒŒì¼)ë“¤ì„ ë³´ê´€í•  ë””ë ‰í† ë¦¬ì˜ **ì ˆëŒ€ ê²½ë¡œ**
- djangoëŠ” ì„±ëŠ¥ì„ ìœ„í•´ ì—…ë¡œë“œ íŒŒì¼ì€ DBì— ì €ì¥í•˜ì§€ ì•ŠìŒ
- ì‹¤ì œ DBì— ì €ì¥ë˜ëŠ” ê²ƒì€ **íŒŒì¼ì˜ ê²½ë¡œ**

- **ì£¼ì˜ğŸ“¢ : MEDIA_ROOTëŠ” STATIC_ROOTì™€ ë°˜ë“œì‹œ ë‹¤ë¥¸ ê²½ë¡œë¡œ ì§€ì •**

```python
# settings.py

MEDIA_ROOT = BASE_DIR / 'media'
```

<br />

#### MEDIA_URL

- MEDIA_ROOTì—ì„œ ì œê³µë˜ëŠ” ë¯¸ë””ì–´ë¥¼ ì²˜ë¦¬í•˜ëŠ” URL
- **ì—…ë¡œë“œëœ íŒŒì¼ì˜ ì£¼ì†Œ**(URL)ë¥¼ ë§Œë“¤ì–´ì£¼ëŠ” ì—­í• 
- ì›¹ ì„œë²„ ì‚¬ìš©ìê°€ ì‚¬ìš©í•˜ëŠ” public URL

- ë¹„ì–´ ìˆì§€ ì•Šì€ ê°’ìœ¼ë¡œ ì„¤ì •í•œë‹¤ë©´ ë°˜ë“œì‹œ slash(/)ë¡œ ëë‚˜ì•¼ í•œë‹¤.

- **ì£¼ì˜ğŸ“¢ : MEDIA_URLì€ STATIC_URLì™€ ë°˜ë“œì‹œ ë‹¤ë¥¸ ê²½ë¡œë¡œ ì§€ì •**

```python
# settings.py

MEDIA_URL = '/media/'
```

<br />

#### ê°œë°œ ë‹¨ê³„ì—ì„œ ì‚¬ìš©ìê°€ ì—…ë¡œë“œí•œ íŒŒì¼ ì œê³µ

- ì°¸ê³ ë¬¸ì„œ : `[django ê³µì‹ë¬¸ì„œ - MEDIA UPLOAD](https://docs.djangoproject.com/ko/4.0/howto/static-files/#serving-files-uploaded-by-a-user-during-development)`
- settings.MEDIA_URL, settings.MEDIA_ROOT í•„ìš”

<br />

> projectì˜ urls.pyì— import

```python
# crud/urls.py
from django.conf import settings
from django.conf.urls.static import static

urlpatterns = [
    # ... the rest of your URLconf goes here ...
] + static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
```

- importì™€ +ë¥¼ ìœ„ì™€ ê°™ì´ ì²˜ë¦¬í•´ì¤€ë‹¤.
- + ëŠ” listì— listë¥¼ ë¶™ì´ëŠ” ë°©ì‹

<br />

> migration

- Pillow pipë¥¼ install
- freezeëŠ” ì„¼ìŠ¤ê»
- migrationì„ ì‹¤ì‹œ

```bash
$ pip install Pillow
$ pip freeze > requirements.txt

$ python manage.py makemigrations
$ python manage.py migrate
```

<br />

### Image ì—…ë¡œë“œ(CREATE)

> form íƒœê·¸ : enctype(ì¸ì½”ë”©) ì†ì„±

**inputíƒ€ì…ì´ Fileì¼ ë•Œì—ëŠ” ë°˜ë“œì‹œ ì¸ì½”ë”© ì†ì„±ì´ í•„ìš”í•˜ë‹¤!!**

- **multipart/form-data**
    - ì „ì†¡ë˜ëŠ” ë°ì´í„°ì˜ í˜•ì‹ì„ ì§€ì •
    - íŒŒì¼/ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹œì— ë°˜ë“œì‹œ ì‚¬ìš©
    - `<input type="file" />`ì„ ì‚¬ìš©í•  ê²½ìš°ì— ì‚¬ìš©

- ê¸°ë³¸ê°’ : ëª¨ë“  ë¬¸ì ì¸ì½”ë”©
- application/x-www-form-urlencoded

- text/plain
    - ì¸ì½”ë”©ì„ í•˜ì§€ ì•Šì€ ë¬¸ì ìƒíƒœë¡œ ì „ì†¡
    - ê³µë°±ì€ '+' ê¸°í˜¸ë¡œ ë³€í™˜í•˜ì§€ë§Œ, íŠ¹ìˆ˜ ë¬¸ìëŠ” ì¸ì½”ë”©í•˜ì§€ ì•ŠìŒ

<br />

> ì½”ë“œ

```html
{%- raw -%}
<!-- articles/create.html -->

{% extends 'base.html' %}

{% block content %}
  <h1>CREATE</h1>
  <hr>
  <form action="{% url 'articles:create' %}" method="POST" enctype="multipart/form-data">
    ...
  </form>
{% endblock content %}
{% endraw -%}
```

<br />

#### accept ì†ì„±

- ì…ë ¥ í—ˆìš©í•  íŒŒì¼ ìœ í˜•ì„ ë‚˜íƒ€ë‚´ëŠ” ë¬¸ìì—´
- ì‰¼í‘œë¡œ êµ¬ë¶„ëœ "ê³ ìœ  íŒŒì¼ ìœ í˜• ì§€ì •ì" (unique file type specifiers)
- **íŒŒì¼ì„ ê²€ì¦í•˜ëŠ” ê²ƒì€ ì•„ë‹˜**
- (accept ì†ì„± ê°’ì„ imageë¼ê³  í•˜ë”ë¼ë„ ë¹„ë””ì˜¤/ì˜¤ë””ì˜¤ ë° ë‹¤ë¥¸ í˜•ì‹ íŒŒì¼ ì œì¶œ ê°€ëŠ¥)

- ê³ ìœ  íŒŒì¼ ìœ í˜• ì§€ì •ì
- `<input type="file">`ì—ì„œ ì„ íƒí•  ìˆ˜ ìˆëŠ” íŒŒì¼ì˜ ì¢…ë¥˜ë¥¼ ì„¤ëª…í•˜ëŠ” ë¬¸ìì—´

<br />

#### request.FILES

> CREATEì—ì„œ ì´ë¯¸ì§€ ì˜ ì˜¬ë ¸ëŠ”ë° ì™œ DBì— ì €ì¥ì´ ì•ˆ ë˜ë‚˜ìš”?

- ì§€ê¸ˆê¹Œì§€ DBì— ë°›ì€ ê²ƒì€ request.POSTì— ìˆëŠ” ì •ë³´
- imageì™€ ê°™ì€ fileì€ **request.FILES**ì— ì €ì¥ë˜ì–´ ì „ë‹¬!!
- ì•„ë˜ì²˜ëŸ¼ argumentë¡œ request.FILESë¥¼ ì¶”ê°€

<br />

```python
def create(request):
    if request.method == 'POST':
        form = ArticleForm(request.POST, request.FILES)
    ...
```

- ìœ„ì˜ ì½”ë“œì²˜ëŸ¼ ì‘ì„±í•˜ë©´ ì´ë¯¸ì§€ê°€ DBì— ì €ì¥
- MEDIA_ROOTì— ì €ì¥ëœ ê²½ë¡œëŒ€ë¡œ image íŒŒì¼ì´ ì €ì¥
- DBì—ëŠ” ê²½ë¡œë§Œ text í˜•ì‹ìœ¼ë¡œ ì €ì¥

<br />

### Image ì½ì–´ì˜¤ê¸°(READ)

```html
{%- raw -%}
<!-- articles/detail.html -->
...
{% block content %}
  <h1>DETAIL</h1>
  <h3>{{ article.pk }}ë²ˆì§¸ ê¸€</h3>
  <img src="{{ article.image.url }}" alt="{{ article.image }}">
  <hr>
  ...
{% endblock content %}
{% endraw -%}
```

- templateì— img íƒœê·¸ë¥¼ ë„£ê³  srcì™€ altë¥¼ article.image.url, article.imageë¡œ ì§€ì •
    - article.image.url : ì—…ë¡œë“œ íŒŒì¼ì˜ ê²½ë¡œ
    - article.image : ì—…ë¡œë“œ íŒŒì¼ì˜ ì´ë¦„

- djangoê°€ ì œê³µí•˜ëŠ” **fileì— ëŒ€í•œ ê¸°ëŠ¥**
- settings.pyì— ì§€ì •í•œ MEDIA_URLì— ì˜ê±°í•´ image ê²½ë¡œ ë° alt ì§€ì •

- static, media íŒŒì¼ ëª¨ë‘ ì„œë²„ì— ìš”ì²­í•´ì„œ ì¡°íšŒí•˜ëŠ” ê²ƒ
- ì„œë²„ì— ìš”ì²­í•˜ê¸° ìœ„í•´ì„œëŠ” urlì´ í•„ìš”

<br />

### Image ìˆ˜ì •(UPDATE)

- ì´ë¯¸ì§€ëŠ” ë°”ì´ë„ˆë¦¬ ë°ì´í„°(í•˜ë‚˜ì˜ ë©ì–´ë¦¬)
- í…ìŠ¤íŠ¸ì²˜ëŸ¼ ì¼ë¶€ë§Œ ìˆ˜ì •í•˜ëŠ” ê²ƒì´ ë¶ˆê°€ëŠ¥
- ë•Œë¬¸ì— **ìƒˆë¡œìš´ ì‚¬ì§„ìœ¼ë¡œ ë®ì–´ ì”Œìš°ëŠ” ë°©ì‹ì„ ì‚¬ìš©**

```html
{%- raw -%}
<!-- articles/update.html -->
<form action="{% url 'articles:create' %}" method="POST" enctype="multipart/form-data">
...
</form>
{% endraw -%}
```

update templateì˜ form íƒœê·¸ì— enctypeì„ ìœ„ì™€ ê°™ì´ ì‘ì„±í•´ë„£ëŠ”ë‹¤.

<br />

```python
# articles/views.py
form = ArticleForm(request.POST, request.FILES, instance=article)
```

- update view í•¨ìˆ˜ì— request.FILES parameter ì…ë ¥
- keyword ì¸ìë¥¼ ì‚¬ìš©í•˜ë©´ ìˆœì„œëŠ” ìƒê´€ ì—†ê³ , ìœ„ì™€ ê°™ì´ ì‘ì„±í•˜ë©´ ìˆœì„œëŒ€ë¡œ ì‘ì„±


<br />

#### ê°™ì€ ì´ë¦„ì˜ íŒŒì¼

> ê°™ì€ ì´ë¦„ì˜ íŒŒì¼ì´ ì—…ë¡œë“œë˜ë©´ ì–´ë–¡í•˜ë‚˜ìš”?

íŒŒì¼ ì´ë¦„ ë’¤ì— ì„ì˜ì˜ ëœë¤ê°’ì´ ë“¤ì–´ê°€ì„œ êµ¬ë¶„ë˜ë‹ˆ ê±±ì • X

<br />

#### imageê°€ ì—†ëŠ” ê²Œì‹œê¸€ ì—ëŸ¬

> image ì—…ë¡œë“œ ì—†ëŠ” ê²Œì‹œê¸€ì€ rendering ì—ëŸ¬ê°€ ëœ¨ëŠ”ë°ìš”?

templateì—ì„œ if íƒœê·¸ë¥¼ ì´ìš©

<br />

- ê¸°ì¡´

```html
{%- raw -%}
<!-- articles/detail.html -->
<img src="{{ article.image.url }}" alt="{{ article.image }}"> 
{% endraw -%}
```

- ìœ„ì˜ ì½”ë“œëŠ” imageê°€ ìˆë‹¤ê³  ê°„ì£¼í•˜ê³  ë°”ë¡œ ë¶€ì—¬
- ì—†ì„ ìˆ˜ë„ ìˆìŒì„ ê°€ì •í•´ì•¼ í•œë‹¤.

<br />

```html
{%- raw -%}
<!-- articles/detail.html -->
{% if article.image %}
  <img src="{{ article.image.url }}" alt="{{ article.image }}"> 
{% endif %}
{% endraw -%}
```

- ìœ„ì²˜ëŸ¼ ifë¬¸ì„ ì´ìš©í•´ article.imageê°€ ìˆëŠ” ê²½ìš°ë§Œ ì¶”ê°€
- ë˜ëŠ” staticìœ¼ë¡œ ê¸°ë³¸ ìŠ¤ì¼ˆë ˆí†¤ ì´ë¯¸ì§€ë¥¼ ë„£ì–´ë„ ëœë‹¤.

<br />

## Image Resizing

> ì´ë¯¸ì§€ í¬ê¸°ê°€ ë„ˆë¬´ í°ë° ì¡°ì •í•  ìˆ˜ ì—†ë‚˜ìš”?

- ì‹¤ì œ ì›ë³¸ ì´ë¯¸ì§€ë¥¼ ì„œë²„ì— ê·¸ëŒ€ë¡œ ì—…ë¡œë“œ í•˜ëŠ” ê²ƒì€ ì„œë²„ì˜ ë¶€ë‹´ì´ í° ì‘ì—…
- img íƒœê·¸ì—ì„œ ì§ì ‘ ì‚¬ì´ì¦ˆë¥¼ ì¡°ì •í•  ìˆ˜ ìˆì§€ë§Œ, **ì—…ë¡œë“œ ë  ë•Œ ì´ë¯¸ì§€ ìì²´ë¥¼ resizingí•˜ëŠ” ê²ƒì„ ê³ ë ¤**
- **django-imagekit ë¼ì´ë¸ŒëŸ¬ë¦¬**(`[ë§í¬](https://github.com/matthewwithanm/django-imagekit)`)í™œìš©
- django-imagekitëŠ” Pillow ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í•„ìš”ë¡œ í•¨

<br />

### django-imagekit

- ê°€. pip install

```bash
$ pip install django-imagekit
```

<br />

- ë‚˜. settings.pyì˜ INSTALLED_APPSì— 'imagekit' ì¶”ê°€

```python
# crud/settings.py

INSTALLED_APPS = [
    'articles',
    'imagekit',
    ...
]
```

<br />

### django-imagekit ì‚¬ìš©

#### ê°€. ì›ë³¸ ì´ë¯¸ì§€ë¥¼ ì¬ê°€ê³µí•˜ì—¬ ì¸ë„¤ì¼ë§Œ ì €ì¥

```python
# ê³µì‹ë¬¸ì„œ

from django.db import models
from imagekit.models import ProcessedImageField
from imagekit.processors import Thumbnail

class Profile(models.Model):
    avatar_thumbnail = ProcessedImageField(upload_to='avatars',
                                           processors=[ResizeToFill(100, 50)],
                                           format='JPEG',
                                           options={'quality': 60})

profile = Profile.objects.all()[0]
print(profile.avatar_thumbnail.url)    # > /media/avatars/MY-avatar.jpg
print(profile.avatar_thumbnail.width)  # > 100
```

ìœ„ëŠ” ê³µì‹ë¬¸ì„œì´ë‹¤. ìš°ë¦¬ì˜ models.pyì— ì ìš©í•´ë³´ì.

<br />

```python
from django.db import models
from imagekit.models import ProcessedImageField
# from imagekit.processors import ResizeToFill  ê³µì‹ë¬¸ì„œëŠ” ì´ê±´ë° ì•„ë˜ thumbnail ì‚¬ìš©
from imagekit.processors import Thumbnail

# Create your models here.
class Article(models.Model):
    title = models.CharField(max_length=10)
    content = models.TextField()
    # image = models.ImageField(upload_to='images/', blank=True)
    image = ProcessedImageField(
        blank=True,
        upload_to='thumbnails/',
        processors=[Thumbnail(200, 300)],
        format='JPEG',
        options={'quality': 60}
    )
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    def __str__(self):
        return self.title
```

- **importë˜ëŠ” ëª¨ë“ˆì„ í™•ì‹¤í•˜ê²Œ import**í•˜ëŠ” ê²ƒì— ì£¼ì˜
- ê¸°ì¡´ ImageField ì£¼ì„ì²˜ë¦¬ : imagekitê°€ ì œê³µí•˜ëŠ” Thumbnail ì‚¬ìš©
- **blank=True** ì§€ì •ì— ì£¼ì˜
- upload_toë¥¼ ë³„ë„ì˜ 'thumbnails/'ë¡œ ì§€ì •
- ****fieldê°€ ë°”ë€Œë¯€ë¡œ migration ì¬ì§„í–‰** ë°˜ë“œì‹œ í•´ì•¼ í•œë‹¤!!

<br />

#### ë‚˜. ì›ë³¸ë„ ì €ì¥, ì¸ë„¤ì¼ë„ ì €ì¥

```python
from django.db import models
from imagekit.models import ProcessedImageField, ImageSpecField
# from imagekit.processors import ResizeToFill  ê³µì‹ë¬¸ì„œëŠ” ì´ê±´ë° ì•„ë˜ thumbnail ì‚¬ìš©
from imagekit.processors import Thumbnail

# Create your models here.
class Article(models.Model):
    title = models.CharField(max_length=10)
    content = models.TextField()
    image = models.ImageField(upload_to='images/', blank=True)
    image_thumbnail = ImageSpecField(
        source='image',     # ì›ë³¸ ImageField ëª…
        processors=[Thumbnail(200, 300)],
        format='JPEG',
        options={'quality': 60}
    )
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    def __str__(self):
        return self.title
```

- imageì™€ image_thumbnailì— ê°ê° ì›ë³¸ê³¼ ì¸ë„¤ì¼ ì €ì¥
- í•„ìš”ì— ë”°ë¼ ì›ë³¸ì´ë‚˜ ì¸ë„¤ì¼ì„ ê°ê° ì‚¬ìš© ê°€ëŠ¥
- ì›ë³¸ì¸ imageë¥¼ ë¨¼ì € ì €ì¥, **blankëŠ” imageì—ì„œ True ì²´í¬**
- **imageë¥¼ sourceë¡œ í•˜ì—¬** thumbnailì¸ image_thumbnail ìƒì„± ë° ì €ì¥