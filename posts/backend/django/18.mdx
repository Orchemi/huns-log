---
title: "[Django] ì™¸ë˜í‚¤ì™€ ëŒ“ê¸€, ê°œì¸ì¸ì¦ ì»¤ìŠ¤í„°ë§ˆì´ì§•"

categories:
  - Django

tags:
  - Django

date: 2022-04-13T18:00
last_modified_at: 2022-04-13T18:00
author_profile: true

toc: true
toc_label: "ëª©ì°¨"
toc_icon: "bars"
toc_sticky: true
published: true
---

## Foreign Key

### ì •ì˜

- ì™¸ë˜ í‚¤(ì™¸ë¶€ í‚¤)
- ê´€ê³„í˜• DBì—ì„œ í•œ í…Œì´ë¸”ì˜ í•„ë“œ ì¤‘ ë‹¤ë¥¸ í…Œì´ë¸”ì˜ í–‰ì„ ì‹ë³„í•  ìˆ˜ ìˆëŠ” í‚¤
- ì°¸ì¡°í•˜ëŠ” í…Œì´ë¸”ì—ì„œ ì†ì„±(í•„ë“œ, ì„¸ë¡œ)ì— í•´ë‹¹í•˜ê³ , ì´ëŠ” ì°¸ì¡°í•˜ëŠ” í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤(PK)ë¥¼ ê°€ë¦¬í‚´
- ì°¸ì¡°í•˜ëŠ” í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ëŠ” ì°¸ì¡°ë˜ëŠ” íƒœì´ë¸” í–‰ 1ê°œì— ëŒ€ì‘
- ì°¸ì¡°í•˜ëŠ” í…Œì´ë¸”ì—ì„œ ì°¸ì¡°ë˜ëŠ” í…Œì´ë¸”ì˜ **ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í–‰ì„ ì°¸ì¡° ë¶ˆê°€ëŠ¥**
- **ì°¸ì¡°í•˜ëŠ” í…Œì´ë¸”ì˜ í–‰ ì—¬ëŸ¬ ê°œ**ê°€ **ì°¸ì¡°ë˜ëŠ” í…Œì´ë¸”ì˜ ë™ì¼í•œ í–‰ì„ ì°¸ì¡° ê°€ëŠ¥**

- 1:N ê´€ê³„ì—ì„œ ì™¸ë˜í‚¤ëŠ” Nì˜ í…Œì´ë¸”ì´ ê°€ì§€ê³  ìˆë‹¤.
  - 1 : ì°¸ì¡°ë˜ëŠ” í…Œì´ë¸”(ê²Œì‹œë¬¼)
  - N : ì°¸ì¡°í•˜ëŠ” í…Œì´ë¸”(ëŒ“ê¸€)

<br />

### íŠ¹ì§•

- í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ **ë¶€ëª¨ í…Œì´ë¸”ì˜ ìœ ì¼í•œ ê°’**ì„ ì°¸ì¡°(ì°¸ì¡° ë¬´ê²°ì„±)
- **ì°¸ì¡° ë¬´ê²°ì„±** : DB ê´€ê³„ ëª¨ë¸ì—ì„œ ê´€ë ¨ëœ 2ê°œì˜ í…Œì´ë¸” ê°„ì˜ ì¼ê´€ì„±
- ì™¸ë˜ í‚¤ì˜ ê°’ì´ ë°˜ë“œì‹œ ë¶€ëª¨ í…Œì´ë¸”ì˜ PKì¼ í•„ìš”ëŠ” ì—†ì§€ë§Œ **ìœ ì¼í•œ ê°’**ì´ì–´ì•¼ í•¨

<br />

### ForeignKey field

- CharField, TextField ë“±ê³¼ ë‹¬ë¦¬ '-Field' ì—†ì´ ForeignKey ê·¸ ìì²´ê°€ Fieldëª…
- 2ê°œì˜ ìœ„ì¹˜ì¸ì ë°˜ë“œì‹œ í•„ìš”
1. ì°¸ì¡°í•˜ëŠ” model class
2. on delete ì˜µì…˜

- migrate ì‘ì—… ì‹œ í•„ë“œ ì´ë¦„ì— _idë¥¼ ì¶”ê°€í•˜ì—¬ DB ì—´ ì´ë¦„ ìƒì„±

```python
models.ForeignKey('self', on_delete=models.CASCADE)
```

<br />

> comment ëª¨ë¸ ì •ì˜

```python
# articles/models.py

class Comment(models.Model):
    article = models.ForeignKey(Article, on_delete=models.CASCADE) â­# ì†Œë¬¸ì ë‹¨ìˆ˜í˜•
    content = models.CharField(max_length=200)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    def __str__(self):
        return self.article
```

- migration í•˜ë©´ í•„ë“œ ì´ë¦„ì— _idë¥¼ ë¶™ì—¬ FK í•„ë“œ ì¶”ê°€
- í•„ë“œëª…ì„ articleë¡œ í•˜ì˜€ìœ¼ë¯€ë¡œ **articles_comment í…Œì´ë¸”**ì— **article_id**ë¡œ ìƒì„±
- ì†Œë¬¸ì ë‹¨ìˆ˜í˜•ìœ¼ë¡œ ì“´ ì´ìœ 
  - ëˆ„êµ¬ë¥¼ ì°¸ì¡°í•˜ëŠ”ì§€
  - ë‹¤ë¥¸ ëª¨ë¸ ê´€ê³„ì™€ í—·ê°ˆë¦¬ì§€ ì•Šì„ ìˆ˜ ìˆìŒ(N:M ê´€ê³„ì™€ êµ¬ë¶„)

<br />

### ForeignKey arguments : on_delete

- ì™¸ë˜ í‚¤ë¥¼ ì°¸ì¡°í•˜ëŠ” ê°ì²´ê°€ ì‚¬ë¼ì¡Œì„ ë•Œ, ì™¸ë˜ í‚¤ë¥¼ ê°€ì§„ ê°ì²´ë¥¼ ì–´ë–»ê²Œ ì²˜ë¦¬í•  ê²ƒì¸ì§€ ì •ì˜
- DB Integrity(ë°ì´í„° ë¬´ê²°ì„±)ì„ ìœ„í•´ì„œ ë§¤ìš° ì¤‘ìš”
- on_delete ì˜µì…˜ì— ì‚¬ìš© ê°€ëŠ¥í•œ ê°’ë“¤
  - CASCADE â­ : ë¶€ëª¨ ê°ì²´(ì°¸ì¡°ëœ ê°ì²´)ì™€ í•¨ê»˜ ì‚­ì œ
  - PROTECT
  - SET_NULL
  - SET_DEFAULT
  - SET()
  - DO_NOTHING
  - RESTRICT

<br />

### ë°ì´í„° ë¬´ê²°ì„±

- ë°ì´í„°ì˜ ì •í™•ì„±ê³¼ ì¼ê´€ì„±ì„ ìœ ì§€í•˜ê³  ë³´ì¦

<br />

> ê°œì²´ ë¬´ê²°ì„±(Entity integrity)

- PKì˜ ê°œë…ê³¼ ê´€ë ¨
- ëª¨ë“  í…Œì´ë¸”ì´ PKë¥¼ ê°€ì§€ê³ , PKë¡œ ì„ íƒëœ ì—´ì€ ê³ ìœ í•œ ê°’
- PKëŠ” ë¹ˆ ê°’ì„ í—ˆìš© X

<br />

> ì°¸ì¡° ë¬´ê²°ì„±(Referential integrity) â­

- FKì˜ ê°œë…ê³¼ ê´€ë ¨
- FK ê°’ì´ DBì˜ íŠ¹ì • í…Œì´ë¸”ì˜ PK ê°’ì„ ì°¸ì¡°

<br />

> ë²”ìœ„(ë„ë©”ì¸) ë¬´ê²°ì„±(Domain integrity)

- ì •ì˜ëœ í˜•ì‹(ë²”ìœ„)ì—ì„œ ê´€ê³„í˜• DBì˜ ëª¨ë“  ì»¬ëŸ¼ì´ ì„ ì–¸ë˜ë„ë¡ ê·œì •

<br />

### shell_plus ì‹¤ìŠµ

> ê°€. ìƒì„±, ë‚´ìš©ì¶”ê°€, ì €ì¥ ë³„ë„

```bash
$ python manage.py shell_plus

In [1]: comment = Comment()

In [2]: comment.content = 'first comment'

In [3]: comment.save()

IntegrityError: NOT NULL constraint failed: articles_comment.article_id
# ì–´ë–¤ ê²Œì‹œë¬¼ì„ ì°¸ì¡°í•˜ëŠ”ì§€ì— ëŒ€í•œ ì •ë³´ê°€ ì—†ì–´ì„œ ì—ëŸ¬ ë°œìƒ

# ì°¸ì¡° ê²Œì‹œë¬¼ ìƒì„±
In [4]: article = Article.objects.create(title='title', content='content')

In [5]: article.pk
Out[5]: 1

# ìœ„ì—ì„œ ì •ì˜í•œ comment
In [6]: comment.content
Out[6]: 'first comment'

# commentì— ì°¸ì¡°í•˜ëŠ” article ê°ì²´ëŠ” ìœ„ì—ì„œ ìƒì„±í•œ 1ë²ˆ article ì¸ìŠ¤í„´ìŠ¤
In [7]: comment.article = article

In [8]: comment.save()

# commentê°€ ì˜ ì €ì¥, ì°¸ì¡° ê°ì²´ë„ í™•ì¸ ê°€ëŠ¥
In [9]: comment.pk
Out[9]: 1

# ì°¸ì¡° ê°ì²´ì˜ ì •ë³´(ì†ì„±ê°’)ë„ í™•ì¸ ê°€ëŠ¥
In [10]: comment.article
Out[10]: <Article: title>

In [11]: comment.article.title
Out[11]: 'title'
```

- í•„ë“œ ì°¸ì¡° : comment.article_id = article.pk
- ê°ì²´ ì°¸ì¡°(ê¶Œì¥) : comment.article = article

<br />

> ë‚˜. ìƒì„±-ë‚´ìš©, ì €ì¥

```bash
In [12]: comment = Comment(content='second comment', article=article)

In [13]: comment.save()

In [14]: comment.pk
Out[14]: 2

In [15]: comment.article.pk
Out[15]: 1

In [16]: comment.article_id
Out[16]: 1
```

- **comment.article.pk**ì™€ **comment.article_id**ë¥¼ í˜¼ë™í•˜ì§€ ì•Šë„ë¡ ì£¼ì˜
  - comment.article.pk : í˜„ì¬ commentê°€ ì°¸ì¡°í•˜ëŠ” article ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ê°€ì ¸ì˜¤ëŠ” pk
  - comment.article_id : comment ìƒì„±ì‹œ article_id í•„ë“œì— ì €ì¥ë˜ëŠ” article ì¸ìŠ¤í„´ìŠ¤ì˜ pk
  - ê°™ì€ ê°œë…ì´ì§€ë§Œ comment.article_pk ì²˜ëŸ¼ ì‘ì„±í•˜ì§€ ì•Šë„ë¡ ì£¼ì˜

<br />

### ì—­ì°¸ì¡° : comment_set

> commentê°€ articleì„ ì°¸ì¡°í•˜ëŠ”ë°, articleì´ commentë¥¼ ì°¾ì„ ë°©ë²•ì´ ì—†ë‚˜ìš”?

ì™¸ë˜í‚¤ê°€ ì°¸ì¡°í•˜ëŠ” ëª¨ë¸ì˜ ì¸ìŠ¤í„´ìŠ¤ + **comment_set**ì„ ì´ìš©í•´ ì°¸ì¡°í•  ìˆ˜ ìˆë‹¤.

```bash
article.comment_set
```

- **article.comment_set** manager ìƒì„±
- ê²Œì‹œê¸€ì— ëª‡ ê°œì˜ ëŒ“ê¸€ì´ ì‘ì„±ë˜ì—ˆëŠ”ì§€ ORMì´ ë³´ì¥ ë¶ˆê°€ëŠ¥
  - articleì—ëŠ” commentê°€ ì—†ì„ ìˆ˜ë„, ë§ì„ ìˆ˜ë„ ìˆìŒ
  - ì‹¤ì œë¡œ Article í´ë˜ìŠ¤ì—ëŠ” Commentì™€ì˜ ì–´ë– í•œ ê´€ê³„ë„ ì‘ì„±ë˜ì–´ ìˆì§€ ì•ŠìŒ

<br />

```bash
In [1]: article = Article.objects.get(pk=1)

In [2]: article
Out[2]: <Article: title>

In [3]: article.comment_set.all()
Out[3]: <QuerySet [<Comment: first comment>, <Comment: second comment>]>

# 1ë²ˆ article ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¸ì¡°í•˜ëŠ” ëŒ“ê¸€ querysetì„ commentsì— ì €ì¥
In [4]: comments = article.comment_set.all()

# querysetì˜ ê° commentì˜ contentë¥¼ ì¶œë ¥
In [5]: for comment in comments:
   ...:     print(comment.content)
   ...: 
first comment
second comment
```

<br />

> ê²Œì‹œê¸€ì—ì„œ ëŒ“ê¸€ì˜ ê°œìˆ˜ê°€ ì™œ ì¤‘ìš”í•˜ì£ ?

- ì°¸ì¡°ì˜ ê²½ìš°, commentì˜ ì¡´ì¬ë¥¼ ìœ„í•´ articleì´ ë¬´ì¡°ê±´ í•„ìš”
- **comment.article ë°©ì‹**ìœ¼ë¡œ ì¡°íšŒê°€ ê°€ëŠ¥
- ë°˜ëŒ€ì˜ ê²½ìš°, ì´ê²ƒì´ ë¶ˆê°€ëŠ¥í•˜ë¯€ë¡œ ì—­ì°¸ì¡° manager ìƒì„±

<br />

> comment_set managerê°€ ë„ˆë¬´ ê¸¸ì–´ìš”. ì¬ì •ì˜í•  ìˆ˜ ìˆë‚˜ìš”?

**related_name** ì†ì„±ì„ ì´ìš©í•´ ì¬ì •ì˜í•  ìˆ˜ ìˆë‹¤.

```python
# models.py / class Comment
article = models.ForeignKey(Article, on_delete=models.CASCADE, related_name='comments')
```

<br />

> ì£¼ì˜ì‚¬í•­

- migrationì„ ë‹¤ì‹œ í•´ì•¼ í•¨
- ê³¼ê±°ì— ìˆë˜ comment_setì˜ model managerë¥¼ ì‚¬ìš© ë¶ˆê°€
- djangoì˜ 1:N ê´€ê³„ì—ì„œëŠ” related_nameì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²ƒì„ ê¶Œì¥
  - M:Nì—ì„œëŠ” related_nameì„ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ìˆìŒ
  - 1:Nì—ì„œëŠ” _set ë°©ì‹ì„ ì‚¬ìš©í•´ì„œ êµ¬ë¶„í•˜ê¸° ìš©ì´

<br />

## Comment CREATE

### ì½”ë“œ

> CommentForm ì‘ì„±

```python
# articles/forms.py
from .models import Article, Comment

class CommentForm(forms.ModelForm):
    
    class Meta:
        model = Comment
        fields = '__all__'
```

- CommentForm : Comment modelì„ ì°¸ì¡°í•˜ëŠ” ModelForm ì •ì˜

<br />

> detail view í•¨ìˆ˜ ìˆ˜ì •

```python
# articles/views.py
from .forms import ArticleForm, CommentForm

@require_safe
def detail(request, pk):
    article = get_object_or_404(Article, pk=pk)
    comment_form = CommentForm()
    context = {
        'article': article,
        'comment_form': comment_form,
    }
    return render(request, 'articles/detail.html', context)
```

- CommentFormì„ import
- comment_formì˜ ë¹ˆ í¼ì„ ë§Œë“¤ì–´ contextë¡œ templateì— ì „ë‹¬

<br />

> detail template ìˆ˜ì •

```html
{%- raw -%}
<!-- articles/detail.html -->
{% block content %}
  ...
  <form action="" method="POST">
    {% csrf_token %}
    {{ comment_form }}
    <input type="submit">
  </form>
{% endblock content %}
{% endraw -%}
```

- ëŒ“ê¸€ í¼ì„ í‘œì‹œí•˜ëŠ” í¼ íƒœê·¸ ì¶”ê°€

<br />

> ë¬¸ì œìƒí™© : ForeignKeyFieldë¥¼ ì§ì ‘ ì‘ì„±í•´ì•¼ ë˜ê²Œ ëëŠ”ë°ìš”?

`![image](https://user-images.githubusercontent.com/86189596/163081294-21150863-4325-452b-9772-17c849d1e709.png)`

<br />

CommentFormì˜ fieldì—ì„œ ì™¸ë˜ í‚¤ ì¶œë ¥ì„ ì œì™¸í•œë‹¤.

```python
class CommentForm(forms.ModelForm):
    
    class Meta:
        model = Comment
        # fields = '__all__'
        exclude = ('article', )
```

<br />

### ëŒ“ê¸€ ìƒì„± ë¡œì§

> urls

```python
# articles/urls.py
app_name = 'articles'
urlpatterns = [
    ...
    path('<int:pk>/comments/', views.comments_create, name='comments_create'),
]
```

<br />

> template

```html
{%- raw -%}
<!-- articles/detail.html -->
<form action="{% url 'articles:comments_create' article.pk %}" method="POST">
  {% csrf_token %}
  {{ comment_form }}
  <input type="submit">
</form>
{% endraw -%}
```

- actionì˜ URLì„ ì±„ì›Œì¤€ë‹¤.
- ëŒ“ê¸€í¼ì´ ì±„ì›Œì§€ë©´ comments_create view í•¨ìˆ˜ë¥¼ POST methodë¡œ í˜¸ì¶œ

<br />

> view

- pkë¡œë¶€í„° ê²Œì‹œë¬¼ì„ ë°›ì•„ì™€ ì €ì¥
- í¼ ì‘ì„± ë°ì´í„° ê¸°ë°˜ìœ¼ë¡œ comment_form ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
- ìœ íš¨í•˜ë‹¤ë©´ ì €ì¥

```python
# articles/views.py
def comments_create(request, pk):
    article = Article.objects.get(pk=pk)
    comment_form = CommentForm(request.POST)
    if comment_form.is_valid():
        comment_form.save()
    return redirect('articles:detail', article.pk)
```

ì´ë ‡ê²Œ í•˜ë©´ ë˜ì§€ ì•Šì„ê¹Œ?

<br />

> IntegrityErrorê°€ ë°œìƒí•˜ëŠ”ë°ìš”?

ì•ì„œ ForeignKey fieldë¥¼ formì—ì„œ ìˆ¨ê²¨ì„œ **ForeignKeyì— ëŒ€í•œ ì •ë³´ê°€ ì—†ê¸° ë•Œë¬¸!**

<br />

### save() method : commit=False

- **DBì— ì €ì¥ë˜ì§€ ì•Šì€ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜**
- **ì €ì¥ ì „ ê°ì²´ì— ëŒ€í•œ ì‚¬ìš©ì ì§€ì • ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•  ë•Œ** í•„ìš”
- commitì˜ defaultëŠ” True

```python
# articles/views.py
def comments_create(request, pk):
    article = Article.objects.get(pk=pk)
    comment_form = CommentForm(request.POST)
    if comment_form.is_valid():
        # commit FalseëŠ” DBì— ì €ì¥ ì—†ì´ ì¸ìŠ¤í„´ìŠ¤ë§Œ ë°˜í™˜í•´ commentì— ì €ì¥
        comment = comment_form.save(commit=False)
        # ì•ì„œ ì¡°íšŒí•œ article ê°ì²´ë¥¼ commentì˜ ê°ì²´ë¡œ ì§€ì •
        comment.article = article
        comment.save()
    return redirect('articles:detail', article.pk)
```

<br />

## Comment READ

> view

íŠ¹ì • articleì— ìˆëŠ” ëª¨ë“  ëŒ“ê¸€ì„ ê°€ì ¸ì˜¨ í›„ contextì— ì¶”ê°€

```python
# articles/detail.py

@require_safe
def detail(request, pk):
    article = get_object_or_404(Article, pk=pk)
    comment_form = CommentForm()
    comments = article.comment_set.all() ğŸ”…
    context = {
        'article': article,
        'comment_form': comment_form,
        'comments': comments, ğŸ”…
    }
    return render(request, 'articles/detail.html', context)
```

<br />

> template

```html
{%- raw -%}
<!-- articles/detail.html -->
{% endblock content %}
  ...
  <a href="{% url 'articles:index' %}">back</a>
  <hr>
  <h4>ëŒ“ê¸€ ëª©ë¡</h4>
  <ul>
    {% for comment in comments %}
      <li>{{ comment.content }}</li>
    {% endfor %}
  </ul>
  ...
{% endblock content %}
{% endraw -%}
```

- forë¬¸ì„ ì´ìš©í•´ comments querysetì˜ commentë§ˆë‹¤ contentë¥¼ ì¶”ê°€

<br />

## Comment DELETE

> url

```python
# articles/urls.py

app_name = 'articles'
urlpatterns = [
    ...
    path('<int:article_pk>/comments/<int:comment_pk>/delete/', views.comments_delete, name='comments_delete'),
]
```

- viewì—ì„œ ì¸ìŠ¤í„´ìŠ¤ ë©”ì„œë“œë¥¼ í†µí•´ article_pkë¥¼ ì°¾ì„ ìˆ˜ ìˆë‹¤.
- í•˜ì§€ë§Œ variable routingì„ ì´ìš©í•´ articleì˜ pkì™€ commentì˜ pkë¥¼ ë°›ëŠ”ë‹¤.
- **urls.pyì˜ ì¼ê´€ì„±**ê³¼ **REST APIì˜ ê·œì¹™**ì„ ìœ„í•´ ìœ„ ë°©ì‹ ì„ íƒ

<br />

> view

```python
# articles/views.py

def comments_delete(request, article_pk, comment_pk):
    comment = Comment.objects.get(pk=comment_pk)
    comment.delete()
    return redirect('articles:detail', article_pk)
```

<br />

> template

```html
{%- raw -%}
<!-- articles/detail.html -->
<li>
  {{ comment.content }}
  <form action="{% url 'articles:comments_delete' article.pk comment.pk %}" method="POST">
    {% csrf_token %}
    <input type="submit" value="ì‚­ì œ">
  </form>
</li>
{% endraw -%}
```

- li íƒœê·¸, ì¦‰ ëŒ“ê¸€ë§ˆë‹¤ ì‚­ì œ ë²„íŠ¼ ì¶”ê°€
- action URLì— article.pk, comment.pk variable í•¨ê»˜ ì „ë‹¬

<br />

> view ì½”ë“œ ìµœì¢…

```python
@require_POST
def comments_create(request, pk):
    if request.user.is_authenticated:
        article = get_object_or_404(Article, pk=pk)
        comment_form = CommentForm(request.POST)
        if comment_form.is_valid():
            comment = comment_form.save(commit=False)
            comment.article = article
            comment.save()
        return redirect('articles:detail', article.pk)
    return redirect('accounts:login')


@require_POST
def comments_delete(request, article_pk, comment_pk):
    if request.user.is_authenticated:
        comment = get_object_or_404(Comment, pk=comment_pk)
        comment.delete()
    return redirect('articles:detail', article_pk)
```

- is_authenticated ë° POST method ë“±ì— ëŒ€í•œ shortcut ì¶”ê°€

<br />

## Customizing authentication in Django

### User ëª¨ë¸ ëŒ€ì²´

> Substituting a custom User model

- íŠ¹ì • í”„ë¡œì íŠ¸ì—ì„œëŠ” Djangoì˜ **ë‚´ì¥ User ëª¨ë¸ì´ ì œê³µí•˜ëŠ” ì¸ì¦ ìš”êµ¬ì‚¬í•­ì´ ì ì ˆí•˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤.**
- ex) username ëŒ€ì‹  emailì„ ì‹ë³„ í† í°ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” ì í•©í•œ ì‚¬ì´íŠ¸

- DjangoëŠ” Userë¥¼ ì°¸ì¡°í•˜ëŠ”ë° ì‚¬ìš©í•˜ëŠ” **AUTH_USER_MODEL** ê°’ì„ ì œê³µí•˜ì—¬, default user modelì„ **ì¬ì •ì˜(override)**í•  ìˆ˜ ìˆë„ë¡ í•¨

- DjangoëŠ” ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•˜ëŠ” ê²½ìš° ê¸°ë³¸ ì‚¬ìš©ì ëª¨ë¸ì´ ì¶©ë¶„í•˜ë”ë¼ë„, **ì»¤ìŠ¤í…€ ìœ ì € ëª¨ë¸ì„ ì„¤ì •í•˜ëŠ” ê²ƒì„ ê°•ë ¥í•˜ê²Œ ê¶Œì¥(highly recommended)** â­
- ë‹¨, **í”„ë¡œì íŠ¸ì˜ ëª¨ë“  migrations í˜¹ì€ ì²« migrateë¥¼ ì‹¤í–‰í•˜ê¸° ì „ì— ì´ ì‘ì—…ì„ ë§ˆì³ì•¼ í•¨**

> "ì“°ë“  ì•ˆ ì“°ë“  ì‚¬ëŒ ì¼ ëª¨ë¥´ë‹ˆê¹Œ í”„ë¡œì íŠ¸ ì²« ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ì— ì»¤ìŠ¤í…€ User ëª¨ë¸ë¡œ ê¼­ ëŒ€ì²´ë¥¼ í•˜ê³  ì‹œì‘í•´ë¼!! ë§ˆì´ê·¸ë ˆì´ì…˜ í•˜ë©´ ë‚˜ì¤‘ì— ëª» ë°”ê¾¼ë‹¤!!"

<br />

### AUTH_USER_MODEL

- Userë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë°ì— ì‚¬ìš©ë˜ëŠ” ëª¨ë¸
- **í”„ë¡œì íŠ¸ê°€ ì§„í–‰ë˜ëŠ”ë™ì•ˆ ë³€ê²½í•  ìˆ˜ ì—†ìŒ**
- í”„ë¡œì íŠ¸ ì‹œì‘ ì‹œ ì„¤ì •í•˜ê¸° ìœ„í•œ ê²ƒ
- ì°¸ì¡°í•˜ëŠ” ëª¨ë¸ì€ ì²« ë²ˆì§¸ ë§ˆì´ê·¸ë ˆì´ì…˜ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ì•¼ í•¨
- **ê¸°ë³¸ ê°’: auth.User** (auth ì•±ì˜ User ëª¨ë¸)

<br />

> í”„ë¡œì íŠ¸ ì¤‘ê°„(mid-project)ì— AUTH_USER_MODEL ë³€ê²½

- ì •í™•íˆëŠ” ì ˆëŒ€ ë¶ˆê°€ëŠ¥ì€ ì•„ë‹ˆë‹¤.
- ëª¨ë¸ ê´€ê³„ì— ì˜í–¥ì„ ë¯¸ì¹˜ê¸° ë•Œë¬¸ì— ë¶ˆê°€ëŠ¥ì— ê°€ê¹Œìš´ í›¨ì”¬ ë” ì–´ë ¤ìš´ ì‘ì—…ì„ ìš”í•œë‹¤.

<br />

### Custom User ëª¨ë¸ ì •ì˜

> ê°€. ìƒˆ User ëª¨ë¸ ì •ì˜

ì™„ì „í•œ User ëª¨ë¸ì„ êµ¬í˜„í•˜ëŠ” ê¸°ë³¸ í´ë˜ìŠ¤ì¸ **AbstractUserë¥¼ ìƒì†ë°›ì•„ ìƒˆë¡œìš´ User ëª¨ë¸ ì‘ì„±**

```python
# accounts/models.py
from django.contrib.auth.models import AbstractUser

class User(AbstractUser):
    pass
```

<br />

> ë‚˜. settings-AUTH_USER_MODEL ì¶”ê°€

- Djangoê°€ ì‚¬ìš©í•˜ëŠ” Userëª¨ë¸
  - ê¸°ì¡´ : auth ì•±ì˜ User ëª¨ë¸
  - ëŒ€ì²´ : accounts ì•±ì˜ User ëª¨ë¸

- ê¸°ë³¸ì ìœ¼ë¡œ ë‚´ì¥ëœ ê²½ë¡œì´ë¯€ë¡œ settings.pyì— ìƒˆë¡œ ë„£ì–´ì£¼ì–´ ë®ì–´ì”Œìš°ë©´ ëœë‹¤.

```python
# settings.py

AUTH_USER_MODEL = 'accounts.User'
```

<br />

> admin siteì— Custom User ëª¨ë¸ ë“±ë¡

```python
# accounts/admin.py

from django.contrib import admin
from django.contrib.auth.admin import UserAdmin
from .models import User

admin.site.register(User, UserAdmin)
```

ìƒˆ User ëª¨ë¸ì„ ì •ì˜í•˜ë©° admin í˜ì´ì§€ì—ì„œ ì‚¬ë¼ì§„ **ì‚¬ìš©ì(ë“¤) íƒ­**ì„ ë‹¤ì‹œ ì¶”ê°€í•˜ëŠ” ì½”ë“œ

<br />

> DB ì´ˆê¸°í™” ë° ë§ˆì´ê·¸ë ˆì´ì…˜

í”„ë¡œì íŠ¸ ì¤‘ê°„ì— ì§„í–‰í–ˆê¸° ë•Œë¬¸ì— ì œê±° í›„ ë§ˆì´ê·¸ë ˆì´ì…˜

- db.sqlite3 íŒŒì¼ ì‚­ì œ
- migrations íŒŒì¼ ëª¨ë‘ ì‚­ì œ(**íŒŒì¼ëª…ì— ìˆ«ìê°€ ë¶™ì€ íŒŒì¼ë§Œ ì‚­ì œ**, í´ë” ì§€ìš°ë©´ ì•ˆ ë¨)

```bash
$ python manage.py makemigrations

$ python manage.py migrate
```

<br />

## Custom user & Built-in auth forms

> ë°”ë€ User ëª¨ë¸ì— ì˜í•´ ë°œìƒí•œ ë¬¸ì œë“¤ì„ í•´ê²°í•´ë³´ì

<br />

### ê°€. íšŒì›ê°€ì… ì˜¤ë¥˜

> ë¬¸ì œì  : íšŒì›ê°€ì…ì´ ì•ˆ ë©ë‹ˆë‹¤

- íšŒì›ê°€ì…ì—ì„œ UserCreationForm(ModelForm)ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸
- ModelFormì˜ class Metaì— modelì´ ê¸°ì¡´ ë‚´ì¥ User ëª¨ë¸ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸

1. ì»¤ìŠ¤í…€ ModelFormì„ ë§Œë“¤ê³  ê¸°ì¡´ Built-in Formì„ ìƒì†
2. modelì„ ì¬ì •ì˜
3. ì»¤ìŠ¤í…€ ModelFormìœ¼ë¡œ ê¸°ì¡´ ModelForm ëŒ€ì²´

<br />

> forms.py

```python
# accounts/forms.py
from django.contrib.auth.forms import UserChangeForm, UserCreationForm

class CustomUserCreationForm(UserCreationForm):
    
    class Meta:
        # í˜„ì¬ djangoì—ì„œ í™œì„±í™”ëœ User ëª¨ë¸ ê°€ì ¸ì˜´
        model = get_user_model()
        # ìƒì†í•˜ëŠ” ë¶€ëª¨ í´ë˜ìŠ¤ì˜ Meta class ë‚´ fields, ê·¸ë¦¬ê³  ë‚´ê°€ ì›í•˜ëŠ” fields ì¶”ê°€
        fields = UserCreationForm.Meta.fields + ('email',)
```

<br />

> views.py

```python
# accounts/views.py
from .forms import CustomUserCreationForm

@require_http_methods(['GET', 'POST'])
def signup(request):
    if request.user.is_authenticated:
        return redirect('articles:index')

    if request.method == 'POST':
        form = CustomUserCreationForm(request.POST)
        if form.is_valid():
            user = form.save()
            auth_login(request, user)
            return redirect('articles:index')
    else:
        form = CustomUserCreationForm()
    context = {
        'form': form,
    }
    return render(request, 'accounts/signup.html', context)
```

<br />

### ë‚˜. íšŒì›ì •ë³´ ìˆ˜ì • ì˜¤ë¥˜

> ë¬¸ì œ : íšŒì›ì •ë³´ ìˆ˜ì •ì´ ì•ˆ ë©ë‹ˆë‹¤

- ìœ„ì™€ ê°™ì€ ì´ìœ 
- UserChangeFormë¥¼ ìƒì†í•˜ëŠ” CustomUserChangeFormì„ ì •ì˜ í›„ overriding

<br />

### get_user_model()

- **í˜„ì¬ í”„ë¡œì íŠ¸ì—ì„œ í™œì„±í™”ëœ ì‚¬ìš©ì ëª¨ë¸**(active user model)ì„ ë°˜í™˜
- User ëª¨ë¸ì„ ì»¤ìŠ¤í„°ë§ˆì´ì§•í•œ ìƒí™©ì—ì„œëŠ” Custom User ëª¨ë¸ì„ ë°˜í™˜

- ì´ ë•Œë¬¸ì— DjangoëŠ” User í´ë˜ìŠ¤ë¥¼ **ì§ì ‘ ì°¸ì¡°í•˜ëŠ” ëŒ€ì‹  django.contrib.auth.get_user_model()ì„ ì‚¬ìš©í•˜ì—¬ ì°¸ì¡°í•´ì•¼ í•œë‹¤ê³  ê°•ì¡°**
- Userë¥¼ ì§ì ‘ ì°¸ì¡°í•˜ë©´, Userë¥¼ ë°”ê¾¸ëŠ” ê²½ìš° ê¸°ì¡´ User ëª¨ë¸ì´ ë¹„í™œì„±í™”ë˜ë©° ë¬¸ì œ ë°œìƒ
- í•­ìƒ í™œì„±í™”ëœ User ëª¨ë¸ì„ ì°¸ì¡°í•˜ëŠ” get_user_model()ì„ ì‚¬ìš©í•˜ì!

<br />

## 1:N ê´€ê³„ ì„¤ì •

### User-Article(1:N)

> Article model classì— userì— ëŒ€í•œ ì •ë³´ë¥¼ ì„¤ì •í•´ë³´ì

```python
# articles/models.py
from django.conf import settings

class Article(models.Model):
    user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE) ğŸ”…
    title = models.CharField(max_length=10)
    ...
```

- modelì—ì„œì˜ user model ì°¸ì¡°ëŠ” í•¨ìˆ˜ë¡œ í•˜ì§€ ì•ŠëŠ”ë‹¤.
  - django.conf.settings import
  - **settings.AUTH_USER_MODEL** ì¸ì ì‚¬ìš©

<br />

### User ëª¨ë¸ ì°¸ì¡° ì¸ì ë° í•¨ìˆ˜ â­

> settings.AUTH_USER_MODEL

- **User ëª¨ë¸ì— ëŒ€í•œ ì™¸ë˜í‚¤ ë˜ëŠ” ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ ì •ì˜**í•  ë•Œ ì‚¬ìš©
- returnì´ str
- **models.pyì—ì„œ User ëª¨ë¸ì„ ì°¸ì¡°í•  ë•Œ ì‚¬ìš©**

<br />

> get_user_model()

- í˜„ì¬ í™œì„±í™”(active)ëœ User ëª¨ë¸ì„ ë°˜í™˜
- returnì´ object
- **models.pyê°€ ì•„ë‹Œ ë‹¤ë¥¸ ëª¨ë“  ê³³ì—ì„œ User ëª¨ë¸ì„ ì°¸ì¡°í•  ë•Œ ì‚¬ìš©**

<br />

> Djangoì—ì„œ Appì´ ì‹¤í–‰ë˜ëŠ” ìˆœì„œ

1. INSTALLED_APPì—ì„œ ìˆœì°¨ì ìœ¼ë¡œ APP IMPORT
2. ê° Appì˜ modelsë¥¼ import

- User ì •ì˜í•œ appì˜ modelsë¥¼ ì§€ë‚˜ê¸° ì´ì „ì˜ appë“¤ì˜ modelsì—ì„œ userë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°
- ê°ì²´ë¥¼ returní•˜ë©´ ìœ„í—˜í•˜ê³  strë¡œ returní•´ì•¼ ì•ˆì „í•˜ê¸° ë•Œë¬¸ì—
- settings.AUTH_USER_MODELì„ ì‚¬ìš©í•˜ì—¬ strë¡œ user model ì°¸ì¡°

<br />

> ìš”ì  â­

User ëª¨ë¸ ì°¸ì¡°ì‹œ

- models.pyì¼ ë•Œ : settings.AUTH_USER_MODEL
- models.pyê°€ ì•„ë‹ ë•Œ : get_user_model()

<br />

### migration

> models.pyê°€ ë°”ë€Œì—ˆìœ¼ë¯€ë¡œ migrationí•´ë³´ì

- ê²½ê³  ì˜¤ë¥˜ ë°œìƒ
- null ê°’ì„ í—ˆìš©í•˜ì§€ ì•ŠëŠ” user_id í•„ë“œê°€ ë³„ë„ ê°’ ì—†ì´ articleì— ì¶”ê°€ë˜ì–´ì„œ

- 1 : í˜„ì¬ í™”ë©´ì—ì„œ ê¸°ë³¸ ê°’ì„ ì„¤ì •í•˜ê² ë‹¤.
- 2 : ì¼ë‹¨ ì¤‘ë‹¨í•˜ê³  default ì •ì˜í•˜ê³  ì˜¤ê² ë‹¤.
- 1ì„ ì„ íƒ í›„ ê·¸ëƒ¥ admin user ë²ˆí˜¸ì¸ 1ë¡œ ì„¤ì •í•œë‹¤.

<br />

> user ì„ íƒ?

`![image](https://user-images.githubusercontent.com/86189596/163112362-2d4fe973-3b00-4dd1-b240-e0c19b06d171.png)`

- user, ì¦‰ ì‘ì„±ìë¥¼ ì„ íƒí•˜ê²Œë” ë‚˜ì˜¤ê³  ìˆë‹¤.
- forms.pyì—ì„œ ì´ë¥¼ ìˆ˜ì •í•´ë³´ì.

<br />

> forms.py

```python
# articles/forms.py

class ArticleForm(forms.ModelForm):

    class Meta:
        model = Article
        # fields = '__all__'
        fields = ('title', 'content',)
```

<br />

> Integrity ì—ëŸ¬ ìƒê¸°ëŠ”ë°ìš”?

- ê²Œì‹œê¸€ ì‘ì„± ì‹œ ì‘ì„±ì ì •ë³´(article.user)ê°€ ëˆ„ë½ë˜ì—ˆê¸° ë•Œë¬¸
- ìœ„ì—ì„œ ì™¸ë˜í‚¤ ì„ íƒì„ Formì—ì„œ ì œê±°í–ˆì„ ë•Œ ìƒí™©ê³¼ ê°™ë‹¤.
- create í•¨ìˆ˜ì— ë¡œì§ì„ ì¶”ê°€

<br />

> view ê¸°ì¡´ ì½”ë“œ

```python
# articles/views.py

@login_required
@require_http_methods(['GET', 'POST'])
def create(request):
    if request.method == 'POST':
        form = ArticleForm(request.POST)
        if form.is_valid():
            article = form.save()
            return redirect('articles:detail', article.pk)
    else:
        form = ArticleForm()
    context = {
        'form': form,
    }
    return render(request, 'articles/create.html', context)
```

<br />

> view ìˆ˜ì • ì½”ë“œ

```python
# articles/views.py

@login_required
@require_http_methods(['GET', 'POST'])
def create(request):
    if request.method == 'POST':
        form = ArticleForm(request.POST)
        if form.is_valid():
            article = form.save(commit=False) ğŸ”…
            article.user = request.user ğŸ”…
            article.save() ğŸ”…
            return redirect('articles:detail', article.pk)
    else:
        form = ArticleForm()
    context = {
        'form': form,
    }
    return render(request, 'articles/create.html', context)
```

ì‘ì„±ì ì •ë³´ ì¶”ê°€ ë° ì €ì¥

<br />

### Delete

> ìì‹ ì´ ì‘ì„±í•œ ê²Œì‹œë¬¼ë§Œ ì‚­ì œ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •

> ê¸°ì¡´ ì½”ë“œ

```python
# articles/views.py

@require_POST
def delete(request, pk):
    if request.user.is_authticated:
        article = get_object_or_404(Article, pk=pk)
        article.delete()
    return redirect('articles:index')
```

<br />

> ìˆ˜ì • ì½”ë“œ

```python
# articles/views.py

@require_POST
def delete(request, pk):
    article = get_object_or_404(Article, pk=pk)
    if request.user.is_authticated:
        if request.user == article.user:
            article.delete()
            return redirect('articles:index')
    return redirect('articles:detail', article.pk)
```

<br />

### Update

> ìì‹ ì´ ì‘ì„±í•œ ê²Œì‹œë¬¼ë§Œ ìˆ˜ì • ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •

> ê¸°ì¡´ ì½”ë“œ

```python
# articles/views.py
@login_required
@require_http_methods(['GET', 'POST'])
def update(request, pk):
    article = get_object_or_404(Article, pk=pk)
    if request.method == 'POST':
        form = ArticleForm(request.POST, instance=article)
        if form.is_valid():
            article = form.save()
            return redirect('articles:detail', article.pk)
    else:
        form = ArticleForm(instance=article)
    context = {
        'article': article,
        'form': form,
    }
    return render(request, 'articles/update.html', context)
```

<br />

> ìˆ˜ì • ì½”ë“œ

```python
# articles/views.py
@login_required
@require_http_methods(['GET', 'POST'])
def update(request, pk):
    article = get_object_or_404(Article, pk=pk)
    if request.user == article.user: ğŸ”…
        if request.method == 'POST':
            form = ArticleForm(request.POST, instance=article)
            if form.is_valid():
                article = form.save()
                return redirect('articles:detail', article.pk)
        else:
            form = ArticleForm(instance=article)
    else: ğŸ”…
        return redirect('articles:index')
    context = {
        'article': article,
        'form': form,
    }
    return render(request, 'articles/update.html', context)
```

<br />

### READ

> ê²Œì‹œê¸€ ì‘ì„± userê°€ ëˆ„êµ¬ì¸ì§€ index.htmlì—ì„œ ì¶œë ¥í•´ë³´ì

```html
{%- raw -%}
<!-- articles/index.html -->

{% for article in articles %}
  <p><b>ì‘ì„±ì : {{ article.user }}</b></p> ğŸ”…
  <p>ê¸€ ë²ˆí˜¸: {{ article.pk }}</p>  
  <p>ê¸€ ì œëª©: {{ article.title }}</p>
  <p>ê¸€ ë‚´ìš©: {{ article.content }}</p>
  <a href="{% url 'articles:detail' article.pk %}">DETAIL</a>
  <hr>
{% endfor %}
{% endraw -%}
```

<br />

> í•´ë‹¹ ê²Œì‹œê¸€ì˜ ì‘ì„±ìê°€ ì•„ë‹ˆë¼ë©´, ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ì„ ì¶œë ¥í•˜ì§€ ì•Šë„ë¡ í•´ë³´ì

> ê¸°ì¡´ ì½”ë“œ

```html
{%- raw -%}
<!-- articles/detail.html -->
<hr>
<p>ì œëª© : {{ article.title }}</p>
<p>ë‚´ìš© : {{ article.content }}</p>
<p>ì‘ì„± ì‹œê° : {{ article.created_at }}</p>
<p>ìˆ˜ì • ì‹œê° : {{ article.updated_at }}</p>
<hr>
<a href="{% url 'articles:update' article.pk %}">ìˆ˜ì •</a>
<form action="{% url 'articles:delete' article.pk %}" method="POST">
  {% csrf_token %}
  <input type="submit" value="ì‚­ì œ">
</form>
<a href="{% url 'articles:index' %}">back</a>
{% endraw -%}
```

<br />

> ìˆ˜ì • ì½”ë“œ

```html
{%- raw -%}
<!-- articles/detail.html -->
<hr>
<p>ì œëª© : {{ article.title }}</p>
<p>ë‚´ìš© : {{ article.content }}</p>
<p>ì‘ì„± ì‹œê° : {{ article.created_at }}</p>
<p>ìˆ˜ì • ì‹œê° : {{ article.updated_at }}</p>
<hr>
{% if user == article.user %} ğŸ”…
  <a href="{% url 'articles:update' article.pk %}">ìˆ˜ì •</a>
  <form action="{% url 'articles:delete' article.pk %}" method="POST">
    {% csrf_token %}
    <input type="submit" value="ì‚­ì œ">
  </form>
{% endif %}
<a href="{% url 'articles:index' %}">back</a>
{% endraw -%}
```

<br />

## User-Comment(1:N)

> models.py

```python
# articles/models.py

class Comment(models.Model):
    article = models.ForeignKey(Article, on_delete=models.CASCADE)
    user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE) ğŸ”…
    content = models.CharField(max_length=200)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    def __str__(self):
        return self.content
```

- modelsë¥¼ ë°”ê¿”ì£¼ë¯€ë¡œ migrationì„ ì‹¤ì‹œ

<br />

> user ì„ íƒ

`![image](https://user-images.githubusercontent.com/86189596/163114962-340a1614-099f-44ac-9125-1a703a267bc1.png)`

<br />

> forms.py

user field ì œì™¸

```python
# articles/forms.py

class CommentForm(forms.ModelForm):
    
    class Meta:
        model = Comment
        # fields = '__all__'
        exclude = ('article', 'user',)
```

<br />

> user_id ì—†ì–´ì„œ ì¶”ê°€


```python
# articles/views.py

@require_POST
def comments_create(request, pk):
    if request.user.is_authenticated:
        article = get_object_or_404(Article, pk=pk)
        comment_form = CommentForm(request.POST)
        if comment_form.is_valid():
            comment = comment_form.save(commit=False)
            comment.article = article
            comment.user = request.user ğŸ”…
            comment.save()
        return redirect('articles:detail', article.pk)
    return redirect('accounts:login')
```

FKë¥¼ 2ê°œ ë„£ëŠ” ìƒí™© : user_id, article_id

<br />

### ê¶Œí•œì— ëŒ€í•œ ì‘ì—…

#### ê°€. ë¹„ë¡œê·¸ì¸ ìœ ì €ì—ê²ŒëŠ” ëŒ“ê¸€ form ì¶œë ¥ ìˆ¨ê¸°ê¸°

> ê¸°ì¡´ ì½”ë“œ

```html
{%- raw -%}
<!-- articles/detail.html -->
<form action="{% url 'articles:comments_create' article.pk %}" method="POST">
  {% csrf_token %}
  {{ comment_form }}
  <input type="submit">
</form>
{% endraw -%}
```

<br />

> ìˆ˜ì • ì½”ë“œ

```html
{%- raw -%}
<!-- articles/detail.html -->
{% if request.user.is_authenticated %}
  <form action="{% url 'articles:comments_create' article.pk %}" method="POST">
    {% csrf_token %}
    {{ comment_form }}
    <input type="submit">
  </form>
{% else %}
  <a href="{% url 'accounts:login' %}">[ëŒ“ê¸€ì„ ì‘ì„±í•˜ë ¤ë©´ ë¡œê·¸ì¸í•˜ì„¸ìš”.]</a>
{% endif %}
{% endraw -%}
```

<br />

#### ë‚˜. ëŒ“ê¸€ ì‘ì„±ì ì¶œë ¥

```html
{%- raw -%}
<!-- articles/detail.html -->
<h4>ëŒ“ê¸€ ëª©ë¡</h4>
<ul>
  {% for comment in comments %}
    <li>
      {{ comment.user }} - {{ comment.content }} ğŸ”…
      <form action="{% url 'articles:comments_delete' article.pk comment.pk %}" method="POST">
        {% csrf_token %}
        <input type="submit" value="ì‚­ì œ">
      </form>
    </li>
  {% endfor %}
</ul>
{% endraw -%}
```

<br />

#### ë‹¤. ìì‹ ì´ ì‘ì„±í•œ ëŒ“ê¸€ë§Œ ì‚­ì œ ë²„íŠ¼ ë³´ì´ê¸°

```html
{%- raw -%}
<!-- articles/detail.html -->
<h4>ëŒ“ê¸€ ëª©ë¡</h4>
<ul>
  {% for comment in comments %}
    <li>
      {{ comment.user }} - {{ comment.content }}
      {% if user == comment.user %} ğŸ”…
        <form action="{% url 'articles:comments_delete' article.pk comment.pk %}" method="POST">
          {% csrf_token %}
          <input type="submit" value="ì‚­ì œ">
        </form>
      {% endif %}
    </li>
  {% endfor %}
</ul>
{% endraw -%}
```

<br />

#### ë¼. ìì‹ ì´ ì‘ì„±í•œ ëŒ“ê¸€ë§Œ ì‚­ì œ

```python
# articles/views.py

@require_POST
def comments_delete(request, article_pk, comment_pk):
    if request.user.is_authenticated:
        comment = get_object_or_404(Comment, pk=comment_pk)
        if request.user == comment.user: ğŸ”…
            comment.delete()
    return redirect('articles:detail', article_pk)
```

