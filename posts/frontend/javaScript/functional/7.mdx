---
title: "[functional JS ES6+] ì§€ì—°ì„± 2 : L.flatten, L.flatMap, 2ì°¨ì› ë°°ì—´"

categories:
  - Functional JS

tags:
  - [FE Language, JS, Functional JS]

author_profile: true

date: 2022-06-06T19:00
last_modified_at: 2022-06-06T19:00

toc: true
toc_label: "ëª©ì°¨"
toc_icon: "bars"
toc_sticky: true
---

> ë³¸ í¬ìŠ¤íŠ¸ëŠ” ì¸í”„ëŸ°ì˜ **í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°ê³¼ JavaScript ES6+** ê°•ì˜(`[ë§í¬](https://www.inflearn.com/course/functional-es6)`)ë¥¼ ë“£ê³  ì •ë¦¬í•œ ë‚´ìš©ì…ë‹ˆë‹¤.

<br />

## reduceì™€ mapì˜ í™œìš©

### queryString ë§Œë“¤ê¸°

> ê°ì²´ì˜ ì •ë³´ë¥¼ ì´ìš©í•´ queryStringì„ ë§Œë“œëŠ” ì½”ë“œë¥¼ ì‘ì„±í•´ë³´ì

```js
const queryStr = obj => go(
  obj, // { limit: 10, offset: 10, type: 'notice' }
  object.entries, // [["limit", 10], ["offset", 10], ["type", "notice"]]
  map(([k, v]) => `${k}=${v}`), // ["limit=10", "offset=10", "type=notice"]
  reduce((a, b) => `${a}&${b}`) // "limit=10&offset=10&type=notice"
);

log(queryStr({ limit: 10, offset: 10, type: 'notice' }));
```

<br />

- ì°¸ê³ ë¡œ objë¥¼ ë°›ì•„ì„œ ì²« ê°’ì´ obj ê·¸ëŒ€ë¡œ ì‚¬ìš©ë˜ë¯€ë¡œ pipe í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ë„ ëœë‹¤.

```js
const queryStr = pipe(
  Object.entries, // [["limit", 10], ["offset", 10], ["type", "notice"]]
  map(([k, v]) => `${k}=${v}`), // ["limit=10", "offset=10", "type=notice"]
  reduce((a, b) => `${a}&${b}`) // "limit=10&offset=10&type=notice"
);

log(queryStr({ limit: 10, offset: 10, type: 'notice' }));
```

<br />

### Array.prototype.joinë³´ë‹¤ ë‹¤í˜•ì„±ì´ ë†’ì€ join í•¨ìˆ˜

> reduce ëŒ€ì‹ ì— arrayì—ì„œ ì œê³µí•˜ëŠ” join ë‚´ì¥í•¨ìˆ˜ ì“°ë©´ ì•ˆ ë˜ë‚˜ìš”?

- join í•¨ìˆ˜ëŠ” array ê°ì²´ë¥¼ ìƒì†í•˜ëŠ” ê°ì²´ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥
- ë§ê·¸ëŒ€ë¡œ arrayì˜ prototypeì—ë§Œ ì¡´ì¬í•˜ëŠ” join ë©”ì„œë“œì´ë¯€ë¡œ

- ë°˜ë©´ ìœ„ì˜ reduceëŠ” iterableì´ë¼ë©´ ëª¨ë‘ ì‚¬ìš© ê°€ëŠ¥
- ë” í° ë‹¤í˜•ì„±ì„ í™•ë³´ ê°€ëŠ¥

<br />

> ê·¸ë ‡ë‹¤ë©´ join í•¨ìˆ˜ë¥¼ ë” ë‹¤í˜•ì„±ì´ ë†’ê²Œ ë³€í˜•í•´ë³´ì

```js
const join = curry((sep = ",", iter) => 
  reduce((a, b) => `${a}${sep}${b}`, iter));

const queryStr = pipe(
  Object.entries,
  map(([k, v]) => `${k}=${v}`),
  join('&')
);

log(queryStr({ limit: 10, offset: 10, type: 'notice' }));
```

- goë‚˜ pipeì—ì„œ ì¸ì ì „ë‹¬ì´ ë” ìˆ˜ì›”í•˜ê²Œ í•˜ê¸° ìœ„í•´ curry í•¨ìˆ˜ë¥¼ ì”Œì›Œì„œ ì‘ì„±
- sep(ê²°í•©ë¬¸ì)ì´ ë³„ë„ë¡œ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ìœ¼ë¡œ ',' ì§€ì •
- array ë¿ë§Œì´ ì•„ë‹ˆë¼ iterableì´ë¼ë©´ join í•¨ìˆ˜ ì‚¬ìš© ê°€ëŠ¥
- generatorë¡œ ë§Œë“  iterableë„ join í•¨ìˆ˜ ì‚¬ìš© ê°€ëŠ¥

- join ì´ì „ì˜ í•¨ìˆ˜ë“¤ì€ iterable protocolì„ ë”°ë¥´ê³  ìˆì–´ì„œ **ì§€ì—° ê°€ëŠ¥**

<br />

## takeì™€ find

- ì•ì„œ join í•¨ìˆ˜ë¥¼ reduce í•¨ìˆ˜ë¥¼ í†µí•´ì„œ ì œì‘
- í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°ì€ ê³„ë³´ë¥¼ ë”°ë¥´ë„ë¡ ì‘ì„± ê°€ëŠ¥
- take í•¨ìˆ˜ë¥¼ í†µí•´ find í•¨ìˆ˜ë¥¼ ì œì‘í•´ë³´ì.

> find í•¨ìˆ˜: iterableì—ì„œ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ì²« ë²ˆì§¸ ìš”ì†Œë¥¼ ì°¾ëŠ” í•¨ìˆ˜

<br />

### ì¦‰ì‹œ í‰ê°€ find

```js
const users = [
  { age: 32 },
  { age: 31 },
  { age: 37 },
  { age: 28 },
  { age: 25 },
  { age: 32 },
  { age: 31 },
  { age: 37 },
];

const find = curry((f, iter) => go(
  iter,
  filter(f), // [{age: 28}, {age: 25}]
  take(1), // [{age: 28}], ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ìš”ì†Œ 1ê°œë§Œ ì·¨í•¨
  ([a]) => a)); // {age: 28} : ë°°ì—´ì„ ê¹¨ëŠ” í•¨ìˆ˜

log(find(u => u.age < 30)(users)); // {age: 28}
```

<br />

> ì¦‰ì‹œ í‰ê°€ ì‹«ì–´ìš”

- ìœ„ì˜ í•¨ìˆ˜ëŠ” í•˜ë‚˜ì˜ ê²°ê³¼ê°’ë§Œ êº¼ë‚´ë”ë¼ë„ ì´ì „ê¹Œì§€ ëª¨ë‘ ìˆœíšŒí•˜ë©° ë°°ì—´ì„ ì¤€ë¹„í•˜ëŠ” ìƒí™©
- ì´ë¥¼ ì§€ì—° í‰ê°€ë¥¼ í†µí•´ ë¶ˆí•„ìš”í•œ í‰ê°€ë¥¼ íšŒí”¼í•´ë³´ì.

<br />

### ì§€ì—° í‰ê°€ find

```js
const find = curry((f, iter) => go(
  iter,
  L.filter(f), ğŸ”†
  take(1),
  ([a]) => a));

log(find(u => u.age < 30)(users));
```

- L.filter í•¨ìˆ˜ë¥¼ í†µí•´ takeë¶€í„° í‰ê°€ë¥¼ ì‹œì‘
- take í•¨ìˆ˜ì—ê²Œ ê²°ê³¼ ì—°ì‚°ì„ ë¯¸ë¤„ì„œ í•˜ë‚˜ì˜ ê°’ì´ êº¼ë‚´ì§€ë©´ ë”ì´ìƒì˜ ì—°ì‚°ì„ í•˜ì§€ ì•Šë„ë¡ í•œë‹¤.

<br />

## L.mapê³¼ L.filterë¡œ mapê³¼ filter ë§Œë“¤ê¸°

### L.mapê³¼ map

```js
const map = curry((f, iter) => {
  let res = [];
  iter = iter[Symbol.iterator]();
  let cur;
  while (!(cur = iter.next()).done) {
    const a = cur.value;
    res.push(f(a));
  }
  return res;
});

log(map(a => a + 10, range(4)))
```

ìœ„ì˜ map í•¨ìˆ˜ë¥¼ L.mapì„ ì´ìš©í•´ ë°”ê¿”ë³´ì.

<br />

```js
// go í•¨ìˆ˜ ê¸°ë³¸ êµ¬ì¡°
const map = curry((f, iter) => go(
  iter,
  L.map(f),
  take(Infinity)
));

// ì´ˆê¸°ê°’ iterë¥¼ ì²« í•¨ìˆ˜ì— ì „ë‹¬í•´ go í•¨ìˆ˜ ì¶•ì•½
const map = curry((f, iter) => go(
  L.map(f, iter),
  take(Infinity)
));

// go í•¨ìˆ˜ë¥¼ pipe í•¨ìˆ˜ë¡œ ë³€ê²½
const map = curry(pipe(L.map, take(Infinity)));
```

<br />

### L.filterì™€ filter

```js
// ê¸°ì¡´ filter í•¨ìˆ˜
const filter = curry((f, iter) => {
  let res = [];
  iter = iter[Symbol.iterator]();
  let cur;
  while (!(cur = iter.next()).done) {
    const a = cur.value;
    if (f(a)) res.push(a);
  }
  return res;
})
```

ìœ„ì˜ filter í•¨ìˆ˜ë¥¼ L.filter í•¨ìˆ˜ë¥¼ í†µí•´ ì§€ì—°í‰ê°€ ë°©ì‹ìœ¼ë¡œ ë³€ê²½í•´ë³´ì.

<br />

```js
// go í•¨ìˆ˜ë¥¼ ì´ìš©í•´ L.filter ì²˜ë¦¬
const filter = curry((f, iter) => go(
  iter,
  L.filter(f),
  take(Infinity)
));

// ì´ˆê¸°ê°’ iterë¥¼ ì²« í•¨ìˆ˜ì— ì „ë‹¬í•´ go í•¨ìˆ˜ ì¶•ì•½
const filter = curry((f, iter) => go(
  L.filter(f, iter),
  take(Infinity)
));

// go í•¨ìˆ˜ë¥¼ pipe í•¨ìˆ˜ë¡œ ë³€ê²½
const filter = curry(pipe(L.filter, take(Infinity)));
```

<br />

### L.filter ë¦¬íŒ©í† ë§

> ì•ì„œ ë™ì‘ì„ ëª…í™•íˆ í•˜ê¸° ìœ„í•´ í’€ì–´ì“´ L.filter í•¨ìˆ˜ ì½”ë“œë¥¼ ë¦¬íŒ©í† ë§ í•´ë³´ì.

```js
// ê¸°ì¡´ L.filter
L.filter = curry(function *(f, iter) {
  iter = iter[Symbol.iterator]();
  let cur;
  while(!(cur = iter.next()).done) {
    const a = cur.value;
    if (f(a)) {
      yield a;
    }
  }
});

// ë¦¬íŒ©í† ë§ í›„
L.filter = curry(function *(f, iter) {
  for (const a of iter) {
    if (f(a)) yield a;
  }
});
```

<br />

## L.flattenê³¼ flatten

### L.flatten

> ë°°ì—´ ë‚´ë¶€ì— ë˜ë‹¤ë¥¸ ë°°ì—´ë“¤ì´ ìˆëŠ” ê²½ìš° ì´ë“¤ì„ ëª¨ë‘ êµ¬ì¡°ë¶„í•´í•´ì„œ í•˜ë‚˜ì˜ ë°°ì—´ë¡œ ë§Œë“œëŠ” í•¨ìˆ˜

```js
const list = [[1, 2], 3, 4, [5, 6], [7, 8, 9]];
??? // [1, 2, 3, 4, 5, 6, 7, 8, 9]
```

- ìœ„ì™€ ê°™ì´ ë™ì‘í•˜ê¸° ìœ„í•´ ë§Œë“¤ì–´ì§„ í•¨ìˆ˜ì´ë‹¤.
- ì´ í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ë³´ì.

<br />

```js
// aê°€ Symbol.iteratorë¥¼ ê°€ì§€ê³  ìˆë‹¤ë©´ true
// a[Symbol.iterator]ê°€ nullì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ 'a &&'ë¡œ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
const isIterable = a => a && a[Symbol.iterator];

L.flatten = function *(iter) {
  for (const a for iter) {
    if (isIterable(a)) for (const b of a) yield b;
    else yield a;
  }
}

const it = L.flatten([[1, 2], 3, 4, [5, 6], [7, 8, 9]]);
log([...it]); // [1, 2, 3, 4, 5, 6, 7, 8, 9]
```

<br />

### yield *

> ìœ„ì˜ ì½”ë“œë¥¼ ë³´ë‹¤ ë” ê°„ë‹¨í•˜ê²Œ ë°”ê¿”ë³´ì

```js
L.flatten = function *(iter) {
  for (const a for iter) {
    if (isIterable(a)) yield *a;
    else yield a;
  }
}
```

- `yield *iter`ì€ `for (const val of iter) yield val;`ê³¼ ê°™ë‹¤.

<br />

### ì¦‰ì‹œ í‰ê°€ flatten í•¨ìˆ˜

> L.flattenì„ ì¦‰ì‹œí‰ê°€í•˜ëŠ” í•¨ìˆ˜ flattenì„ L.flatten ê¸°ë°˜ìœ¼ë¡œ ë§Œë“¤ì–´ë³´ì

```js
const flatten = pipe(L.flatten, take(Infinity));
log(flatten([[1, 2], 3, 4, [5, 6], [7, 8, 9]])); // [1, 2, 3, 4, 5, 6, 7, 8, 9]
```

- flatten í•¨ìˆ˜ì— ë°°ì—´ì„ ì¸ìë¡œ ì „ë‹¬í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ìˆœì„œë¡œ ì§„í–‰ëœë‹¤.

1. take í•¨ìˆ˜ëŠ” limitì´ Infinityì´ë¯€ë¡œ L.flattenì˜ yieldë§ˆë‹¤ takeì— ì¶”ê°€í•œë‹¤.
2. L.flattenì€ ë§¤ë²ˆ nextë¥¼ ì§„í–‰í•˜ë©° yieldë¥¼ ë°˜í™˜í•œë‹¤.
3. ì´ë¥¼ ë°˜ë³µí•œë‹¤.

<br />

### L.deepFlat

> ë§Œì•½ ë°°ì—´ ë‚´ë¶€ì— ë˜ ë‚´ë¶€ ë°°ì—´ì´ ìˆë‹¤ë©´?

ê¹Šì€ iterableì„ ëª¨ë‘ í¼ì¹˜ëŠ” L.deepFlat í•¨ìˆ˜ë¥¼ êµ¬í˜„í•´ë³´ì.

```js
L.deepFlat = function *f(iter) {
  for (const a of iter) {
    if (isIterable(a)) yield *f(a);
    else yield a;
  }
};
```

ì¬ê·€ì ìœ¼ë¡œ ë‚´ë¶€ ë°°ì—´ì„ ë‹¤ì‹œ f í•¨ìˆ˜ë¡œ ë„£ì–´ yieldë¥¼ ë‚´ë³´ë‚´ëŠ” ê²ƒì´ë‹¤.

<br />

## L.flatMap, flatMap

### JS ë‚´ì¥ flatMap í•¨ìˆ˜

> flattenê³¼ mapì„ ë™ì‹œì— ì‹¤í–‰í•˜ëŠ” í•¨ìˆ˜

- ìµœì‹  ìë°”ìŠ¤í¬ë¦½íŠ¸ì— ì¶”ê°€
- array.prototypeì—ë§Œ ì¡´ì¬í•˜ëŠ”, ë²”ìš©ì„±ì´ ë–¨ì–´ì§€ëŠ” í•¨ìˆ˜

```js
log([[1, 2], [3, 4], [5, 6, 7], 8, 9].flatMap(a => a)); // [1, 2, 3, 4, 5, 6, 7, 8, 9]
log([[1, 2], [3, 4], [5, 6, 7], 8, 9].flatMap(a => a.map(a => a * a))); // [1, 4, 9, 16, 25, 36, 49, 64, 81]
log(flatten([[1, 2], [3, 4], [5, 6, 7], 8, 9].map(a => a.map(a => a * a)))); // [1, 4, 9, 16, 25, 36, 49, 64, 81]
```


<br />

### L.flatMap

- ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€ ê¸°ë³¸ì ìœ¼ë¡œ ì§€ì—°ì ìœ¼ë¡œ ë™ì‘í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì¶”ê°€
- arrayë¥¼ í¬í•¨í•´ iterableì´ë¼ë©´ ëª¨ë‘ ë™ì‘í•˜ë„ë¡ ì‘ì„±

```js
L.flatMap = curry(pipe(L.map, L.flatten));
const flatMap = curry(pipe(L.map, flatten));

const it = L.flatMap(map(a => a * a), [[1, 2], [3, 4], [5, 6, 7], 8, 9]);
log(it.next()); // {value: 1, done: false}
log(it.next()); // {value: 4, done: false}
log(it.next()); // {value: 9, done: false}
log(it.next()); // {value: 16, done: false}
log(it.next()); // {value: 25, done: false}
```

<br />

> flatMapì˜ í™œìš©

```js
log(flatMap(L.range, [1, 2, 3])); // [0, 0, 1, 0, 1, 2]
```

<br />

## 2ì°¨ì› ë°°ì—´ ë‹¤ë£¨ê¸°

> flattenì„ ì´ìš©í•´ 2ì°¨ì› ë°°ì—´ì„ ë‹¤ë¤„ë³´ì

```js
const arr = [
  [1, 2],
  [3, 4, 5],
  [6, 7, 8],
  [9, 10]
];

go(arr, flatten, log); // [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
go(arr, flatten, filter(a => a % 2), log); // [1, 3, 5, 7, 9]
go(arr, L.flatten, L.filter(a => a % 2), take(3), log); // [1, 3, 5]
```

<br />

## ì§€ì—°ì„± / iterable ì¤‘ì‹¬ í”„ë¡œê·¸ë˜ë° ì‹¤ë¬´ì ì¸ ì½”ë“œ

> ë°ì´í„°ë¥¼ ì‹¤ë¬´ì—ì„œ ì‚¬ìš©í•˜ëŠ” êµ¬ì¡°ë¡œ ë°”ê¾¸ì–´ ì´í•´í•´ë³´ì

```js
const users = [
  {
    name: 'a', age: 21, family: [
      {name: 'a1', age: 53}, {name: 'a2', age: 47},
      {name: 'a3', age: 16}, {name: 'a4', age: 15}
    ]
  },
  {
    name: 'b', age: 24, family: [
      {name: 'b1', age: 58}, {name: 'b2', age: 51},
      {name: 'b3', age: 19}, {name: 'b4', age: 22}
    ]
  },
  {
    name: 'c', age: 31, family: [
      {name: 'c1', age: 64}, {name: 'c2', age: 62}
    ]
  },
  {
    name: 'd', age: 20, family: [
      {name: 'd1', age: 42}, {name: 'd2', age: 42},
      {name: 'd3', age: 11}, {name: 'd4', age: 7}
    ]
  }
];
```

- ìœ„ëŠ” 4ëª…ì˜ ì‚¬ëŒê³¼ ê·¸ ê°€ì¡±ì— ëŒ€í•œ ë°ì´í„°

<br />

```js
go(users, // users ì •ë³´ë¡œë¶€í„°
  L.map(u => u.family), // ê° userì˜ ê°€ì¡±ë“¤ ë¦¬ìŠ¤íŠ¸ë¥¼ ëª¨ì•„
  L.flatten, // ì´ë¥¼ flattení•˜ì—¬ í•œ ë°°ì—´ì— ê°ì²´ë¥¼ ëª¨ì€ë‹¤.
  L.filter(u => u.age < 20), // 20ì„¸ ë¯¸ë§Œì˜ ë¯¸ì„±ë…„ìë§Œ
  L.map(u => u.name), // ì´ë¦„ë§Œì„ ë½‘ëŠ”ë°,
  take(4), // 4ëª…ë§Œ ë½‘ëŠ”ë‹¤.
  log // ["a3", "a4", "b3", "d3"]
)
```

- ê°ì²´ ì§€í–¥ì€ ë°ì´í„° ì¤‘ì‹¬ì¸ ë°˜ë©´, í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°ì€ ì´ë¯¸ ì‘ì„±ëœ í•¨ìˆ˜ë“¤ì— ë°ì´í„°ë¥¼ ë§ì¶”ëŠ” ë°©ì‹
- í•¨ìˆ˜ê°€ ë°ì´í„°ë³´ë‹¤ ìš°ì„ ìˆœìœ„ê°€ ë†’ë‹¤.